a:4:{s:5:"child";a:1:{s:0:"";a:1:{s:3:"rss";a:1:{i:0;a:6:{s:4:"data";s:3:"


";s:7:"attribs";a:1:{s:0:"";a:1:{s:7:"version";s:3:"2.0";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:0:"";a:1:{s:7:"channel";a:1:{i:0;a:6:{s:4:"data";s:307:"
	
	
	
	
	
	
	
	
	
	
	
	       
    	
	      
    	
	      
    	
	      
    	
	      
    	
	      
    	
	      
    	
	      
    	
	      
    	
	      
    	
	      
    	
	      
    	
	      
    	
	      
    	
	      
    	
	      
    	
	      
    	
	      
    	
	      
    	
	      
    	
	  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:4:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:14:"CodeBetter.Com";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:21:"http://codebetter.com";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:30:"Stuff you need to Code Better!";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:13:"lastBuildDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Tue, 11 Jan 2011 17:29:35 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"language";a:1:{i:0;a:5:{s:4:"data";s:2:"en";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:9:"generator";a:1:{i:0;a:5:{s:4:"data";s:39:"http://wordpress.org/?v=3.1-beta1-16732";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"item";a:20:{i:0;a:6:{s:4:"data";s:48:"
		
		
		
		
		
				
		
			
					
			
				
					";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:4:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:64:"Thinking about the user, or “How to consider the experience”";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:57:"http://feedproxy.google.com/~r/CodeBetter/~3/b3IWOm5YYrY/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:110:"http://codebetter.com/kylebaley/2011/02/19/thinking-about-the-user-or-how-to-consider-the-experience/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Sun, 20 Feb 2011 02:01:18 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:2:{i:0;a:5:{s:4:"data";s:8:"BookedIN";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:1;a:5:{s:4:"data";s:14:"User Interface";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:38:"http://codebetter.com/kylebaley/?p=211";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:6118:"<p>Over at my <a href="http://corp.bookedin.net/blog/simple-is-hard/">day, evening, and night job</a>, I just posted something on simplicity. The audience for that blog is such that I don’t really like to go into as much detail as I normally do. Lucky for me, I have all of you&#8230;</p>
<p>We just went through a fairly detailed critique of our application’s UI right down making sure the number of pixels used in the borders for all our dialogs were the same. Nitpicky, you say? Perfectionist? Downright anal, even? I’d be lying if I claimed I didn’t think the same thing at first. (Side note: After trying to parse that last sentence about five times, it probably has no business in a post about simplicity. But you all know what I mean so I’m going anyway.)</p>
<p>After looking at the final product and doing a bunch of reflection and stuff, I’ve decided it was probably one of the best learning experiences of my recent career.</p>
<p>Here are three dialogs that I had just done a bunch of clean-up work on (click for larger versions):</p>
<p><a href="http://kyle.baley.org/content/binary/Windows-Live-Writer/d46f1e542c63_129AE/Edit%20Staff_2.jpg"><img style="padding-left: 0px;padding-right: 0px;padding-top: 0px;border: 0px initial initial" src="http://kyle.baley.org/content/binary/Windows-Live-Writer/d46f1e542c63_129AE/Edit%20Staff_thumb.jpg" border="0" alt="Edit Staff" /></a><a href="http://kyle.baley.org/content/binary/Windows-Live-Writer/d46f1e542c63_129AE/Edit%20Staff_2.jpg"><img style="padding-left: 0px;padding-right: 0px;padding-top: 0px;border: 0px initial initial" src="http://kyle.baley.org/content/binary/Windows-Live-Writer/d46f1e542c63_129AE/Book%20Appointment_thumb.jpg" border="0" alt="Book Appointment" /></a><a href="http://codebetter.com/kylebaley/files/2011/02/Edit-Service.jpg"><img style="padding-left: 0px;padding-right: 0px;padding-top: 0px;border: 0px" src="http://codebetter.com/kylebaley/files/2011/02/Edit-Service_thumb.jpg" border="0" alt="Edit Service" width="244" height="219" /></a></p>
<p>All looking pretty spiffy if I do say so myself.</p>
<p>Now here they are in the format that was given back to me after submitting my work:</p>
<p><a href="http://kyle.baley.org/content/binary/Windows-Live-Writer/d46f1e542c63_129AE/dialog_layout_2.png"><img style="padding-left: 0px;padding-right: 0px;padding-top: 0px;border: 0px initial initial" src="http://kyle.baley.org/content/binary/Windows-Live-Writer/d46f1e542c63_129AE/dialog_layout_thumb.png" border="0" alt="" /></a></p>
<p>Here are some variations on what went through my head when reading this:</p>
<ul>
<li>Who’s gonna notice?</li>
<li>There’s more important stuff to work on</li>
<li>WTF?</li>
</ul>
<p>But being the passive-aggressive hillbilly that I am, I went about correcting the problems and grumbling about looming deadlines like any good <a href="http://www.igloocoder.com/archive/2009/04/23/the-hero-developer.aspx">hero programmer</a> should.</p>
<p>Now let’s assume that I’m being honest with myself and summarize my grumblings a little differently:</p>
<ul>
<li>Yes, this is important but it’s also boring and I want to move on to some <em>real</em> development.</li>
</ul>
<p>(Let it not be said that self-awareness is all it’s cracked up to be.)</p>
<p>This is a symptom of a larger “disease” I had contracted (other than misusing “double quotes”). As a consultant in the software industry, I like solving problems. Once solved, I want to move on to the next one. But a lot of times, the problem is solved only in my head. In this example, I have three fully functional screens. All work to the specifications laid out before me. Individually, there’s nothing wrong here and because of that, in my mind, I had already moved ahead to the next problem.</p>
<p>But user experience is a problem. Judging from our competitors, it’s a rampant one. (Hoo-ah! Bet you didn’t think the hillbilly was capable of that kind of potshottery.) Reflecting on this recent experience, my mindset is partly (possibly mostly) to blame. I didn’t put enough emphasis on the user experience and so my thinking was: In order to succeed, we need to pump out features at any cost. This is what my thirteen-odd years in the business has taught me. As long as you don’t totally screw up the user interface, the user will adapt. And when in doubt, do what Microsoft does.</p>
<p>Now, me taking on the persona I have on this here blog thingy, I can tell you first-hand that simple isn’t easy. (Given how much I’ve edited this post, writing about it ain’t exactly a swing o’ the possum either.) But there’s a reward to getting the user experience right, though. Yes, there’s an emotional response that the user gets and they become champions for your software and blah, blah, blah. That’s all well and good. But thinking more selfishly, I have to work with and use this software for the rest of my career (&lt;random deity&gt; willing). If it has a bunch of little quirks in it that I will never get around to fix it, it’s going to start eating away at me.</p>
<p>QA person: “There’s a bug in the Edit Staff dialog”<br />
Me (to myself): “Woman, that screen has always bugged me with the buttons being slightly too high and everything being a little off-centered.”<br />
Me (to QA person): “Assign it to <a href="http://corp.bookedin.net/our-team.shtml">Mayumi</a>”</p>
<p>Ha ha! I jest, of course. We have no QA person. Why do you think I spent so much time <a href="http://kyle.baley.org/RunningCucumberTestsAgainstGWTAppEngineInTeamCityOrLdquoHowToCIWithUIrdquo.aspx">automating our UI tests</a>?</p>
<p>Time to wrap this up. Closing point: Creating a good user experience is a lot of work but worth the effort. For us, it’s meant taking out features that were already built until we could get the UI right. The nice thing is: once you start enforcing UI standards from the beginning, it’s much easier to maintain them going forward.</p>
<p>Kyle the Experienced</p><img src="http://feeds.feedburner.com/~r/CodeBetter/~4/b3IWOm5YYrY" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:10:"Kyle Baley";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:106:"http://codebetter.com/kylebaley/2011/02/19/thinking-about-the-user-or-how-to-consider-the-experience/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:101:"http://codebetter.com/kylebaley/2011/02/19/thinking-about-the-user-or-how-to-consider-the-experience/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:1;a:6:{s:4:"data";s:45:"
		
		
		
		
		
				
			
					
			
				
					";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:4:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:26:"Subversion and Monodevelop";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:57:"http://feedproxy.google.com/~r/CodeBetter/~3/iCX-Rck14a4/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:84:"http://codebetter.com/petervanooijen/2011/02/17/subversion-and-monodevelop/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Thu, 17 Feb 2011 17:08:30 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:1:{i:0;a:5:{s:4:"data";s:13:"Uncategorized";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:75:"http://codebetter.com/petervanooijen/2011/02/17/subversion-and-monodevelop/";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:2360:"<p>The nice thing about <a href="http://monodevelop.com/">Monodevelop</a> is that it has built in support for subversion. The bad thing is that getting that really to work is a real PITA. There is no documentation at all how to set up a Subversion repository and having MonoDevelop (for Mac)communicate without completely crashing over and over again. This is my public cheatsheet. </p>
<p>The scenario: I have Windows based network centered around a Server 2008. This server has redundant storage and is backed up on a regular scale. For building iPhone apps I have my Macbook. Anything could happen to that, like getting nicked. To preserve my work my Windows server runs <a href="http://www.visualsvn.com/server/">VisualSVN server</a>. Nice and easy tool, it takes two clicks and typing a name to set up a new repository. My work is safe, I have a good history and can share it with (potential) co-workers.</p>
<p>The hard part is linking this repository to a MonoDevelop project. There is no guidance and any error in the url or credentials will crash the complete IDE. The error log on that is not really helpful.</p>
<p>This does work:</p>
<ul>
<li>Create the repository in VisualSVN server
<li>Visit the repository in your browser (don’t forget to go to trunk)
<li>Check your browser includes the closing slash (/)
<li>Copy the Url
<li>Paste the Url in the Version control | Publish dialog
<li>Enter your credentials, also the user name is case sensitive
<li>Click OK and pray</li>
</ul>
<p><a href="http://codebetter.com/petervanooijen/files/2011/02/Subversion-in-MonoDevelop.jpg"><img style="border-bottom: 0px;border-left: 0px;padding-left: 0px;padding-right: 0px;border-top: 0px;border-right: 0px;padding-top: 0px" border="0" alt="Subversion in MonoDevelop" src="http://codebetter.com/petervanooijen/files/2011/02/Subversion-in-MonoDevelop_thumb.jpg" width="579" height="531"></a></p>
<p>The only positive feedback is MonoDevelop not crashing.</p>
<p>Note how also your password shows up in the url.&nbsp; VisualSVN server has an option to use Windows credentials. Don’t do this, your well kept secret password will now show up everywhere. The SVN enterprise version has more options for credentials. Here I’m using separate simple SVN credentials. </p><img src="http://feeds.feedburner.com/~r/CodeBetter/~4/iCX-Rck14a4" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:16:"Peter van Ooijen";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:80:"http://codebetter.com/petervanooijen/2011/02/17/subversion-and-monodevelop/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:75:"http://codebetter.com/petervanooijen/2011/02/17/subversion-and-monodevelop/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:2;a:6:{s:4:"data";s:48:"
		
		
		
		
		
				
		
			
					
			
				
					";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:4:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:37:"Get/Load Polymorphism in NHibernate 3";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:57:"http://feedproxy.google.com/~r/CodeBetter/~3/hsxnhHUYRrA/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:91:"http://codebetter.com/jameskovacs/2011/02/16/getload-polymorphism-in-nhibernate-3/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Wed, 16 Feb 2011 22:38:12 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:2:{i:0;a:5:{s:4:"data";s:4:".NET";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:1;a:5:{s:4:"data";s:10:"NHibernate";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:82:"http://codebetter.com/jameskovacs/2011/02/16/getload-polymorphism-in-nhibernate-3/";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:6726:"<p>[Code for this article is available on GitHub <a href="https://github.com/JamesKovacs/NH3Features/tree/03-GetLoadPolymorphism-Updated">here</a>.]</p>
<p>Nothing gets an OO zealot hot under the collar the way the term polymorphism does. You probably have three questions right now… What does polymorphism have to do with object-relational mapping? How does it relate to NHibernate? And why should I care?</p>
<p>An ORM that supports polymorphic loading allows us to request one type of object, but potentially get an object of a derived type back. As an example, let&#8217;s say we have the following simple inheritance hierarchy in our application:</p>
<p><img style="border-right-width: 0px;padding-left: 0px;padding-right: 0px;border-top-width: 0px;border-bottom-width: 0px;border-left-width: 0px;padding-top: 0px" border="0" alt="Animal Inheritance Hierarchy" src="$_ClassDiagram4.png" width="383" height="233"></p>
<p>We can query for an Animal, but receive back an instance of Dog or Cat instead.</p>
<pre class="brush: csharp;">var dog = session.Get&lt;Animal&gt;(dogId);</pre>
<p>NHibernate has supported this type of polymorphic loading behaviour for awhile, but the base class (or interface) had to be mapped. If it wasn’t, polymorphic loading would only work when querying with Criteria or LINQ. The following works for both NH 2.1.2 and NH3 regardless of whether the Animal base class is mapped or not.</p>
<pre class="brush: csharp;">var animal = session.CreateCriteria&lt;Animal&gt;()
                    .Add(Restrictions.IdEq(dogId))
                    .UniqueResult&lt;Animal&gt;();

// N.B. Use session.Linq&lt;Animal&gt;() in NH2.1.2
var query = from a in session.Query&lt;Animal&gt;()
            where a.Id == dogId
            select a;
var animal = query.Single();</pre>
<p>In NHibernate 2.1.2 and earlier, ISession.Get&lt;T&gt;(id) or ISession.Load&lt;T&gt;(id) would fail if T was an unmapped base class or interface. With NHibernate 3, these methods now work regardless of whether T is mapped or not.*</p>
<pre class="brush: csharp;">// Works in NH3; works in NH2.1.2 only if Animal is mapped
// In the sample code, works in NH3 for both Animal and UnmappedAnimal base classes
// In NH2.1.2 and before, works for Animal (mapped), but not UnmappedAnimal
var dog = session.Get&lt;Animal&gt;(dogId);
var cat = session.Load&lt;Animal&gt;(catId);</pre>
<p>ASIDE: ISession.Get(id) returns null when the entity doesn’t exist in the database, whereas ISession.Load(id) throws an exception. Generally ISession.Load(id) is preferred if you know the entity should exist as NHibernate can return a proxy object that delays hitting the database until the last possible moment. ISession.Get(id) requires querying the database immediately because there is no way to return an object (e.g. a proxy), but later change it to null when accessed.</p>
<p>In NHibernate 3, polymorphic loading works for Criteria, LINQ, and Get/Load. <strike>It has not been implemented for HQL. (If you want/need this feature, the NHibernate team is always willing to accept a feature request with patch.)</strike> HQL in NH3 supports polymorphic loading if the queried class is imported via &lt;import class=”UnmappedClass”/&gt; in a hbm.xml file.</p>
<pre class="brush: csharp;">// Criteria works in NH2.1.2 and NH3
var animal = session.CreateCriteria&lt;UnmappedAnimal&gt;()
                    .Add(Restrictions.IdEq(dogId))
                    .UniqueResult&lt;UnmappedAnimal&gt;());

// LINQ works in NH2.1.2 and NH3 (NH2.1.2 uses session.Linq&lt;T&gt;())
var query = from a in session.Query&lt;UnmappedAnimal&gt;()
            where a.Id == dogId
            select a;
var animal = query.Single();

// Get/Load works in NH3, but fails in NH2.1.2 and earlier
var animal = session.Get&lt;UnmappedAnimal&gt;(dogId);

// HQL works for NH3 if UnmappedAnimal is imported, but fails for NH2.1.2
var animal = session.CreateQuery("from a in UnmappedAnimal where a.id = :id")
                    .SetParameter("id", dogId)
                    .UniqueResult&lt;UnmappedAnimal&gt;());
</pre>
<p>* I should note one restriction on the generic parameter T when calling ISession.Get&lt;T&gt;(id) and ISession.Load&lt;T&gt;(). Polymorphic loading only works if there is a unique persister for T. Otherwise NHibernate throws a HibernateException, “Ambiguous persister for [T] implemented by more than one hierarchy”. What does this mean? Let’s say you have an unmapped abstract base class, such as Entity. (Entity is a class defined in our application, which includes properties common across all persistent entities, such as primary key, audit fields, and similar. It is not required by NHibernate, but often useful for extracting common domain code.) Consider the following contrived example:</p>
<p><img style="border-right-width: 0px;padding-left: 0px;padding-right: 0px;border-top-width: 0px;border-bottom-width: 0px;border-left-width: 0px;padding-top: 0px" border="0" alt="Contrived Inheritance Hierarchy" src="$_ClassDiagram21.png" width="599" height="497"></p>
<p>Note that the Animal inheritance hierarchy is mapped and so is Customer. If we try to execute the following code:</p>
<pre class="brush: csharp;">var id = 42;
var entity = session.Get&lt;Entity&gt;(id);</pre>
<p>We will get a HibernateException as mentioned above. We are asking NHibernate to load an Entity with an id of 42. But primary keys are only unique within a mapped inheritance hierarchy. So there could be a Cat (or Dog) with id of 42 <strong>and</strong> a Customer with id of 42! So NHibernate fails with a HibernateException since it has no way of returning a list of objects from Get/Load. If you really want to query across inheritance hierarchies, you can do so with Critera or LINQ where you return a list of objects. The following code will work:</p>
<pre class="brush: csharp;">var id = 42;
var entities = session.CreateCriteria&lt;Entity&gt;()
                      .Add(Restrictions.IdEq(id))
                      .List&lt;Entity&gt;();</pre>
<p>Here’s a NHibernate trick that makes for a good demo, but isn’t terribly practical in real applications… Retrieve a list of all entities in the database:</p>
<pre class="brush: csharp;">var allEntities = session.CreateCriteria&lt;object&gt;()
                         .List&lt;object&gt;();</pre>
<p>Happy coding!</p>
<p><strong>UPDATE</strong>: Fabio Maulo, NH project lead, pointed out to me that HQL in NHibernate 3 can load unmapped classes so long as you make NHibernate aware of the classes via an &lt;import class=”UnmappedAnimal”/&gt; directive in a hbm.xml file. Thanks, Fabio.</p><img src="http://feeds.feedburner.com/~r/CodeBetter/~4/hsxnhHUYRrA" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:12:"James Kovacs";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:87:"http://codebetter.com/jameskovacs/2011/02/16/getload-polymorphism-in-nhibernate-3/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:82:"http://codebetter.com/jameskovacs/2011/02/16/getload-polymorphism-in-nhibernate-3/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:3;a:6:{s:4:"data";s:75:"
		
		
		
		
		
				
		
		
		
		
		
		
		
		
		
		
			
					
			
				
					";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:4:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:50:"The beauty of Evolutionary Design and Levelization";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:57:"http://feedproxy.google.com/~r/CodeBetter/~3/mOG1CyZognM/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:109:"http://codebetter.com/patricksmacchia/2011/02/15/the-beauty-of-evolutionary-design-and-levelization/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Tue, 15 Feb 2011 17:27:21 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:11:{i:0;a:5:{s:4:"data";s:24:"Acyclic componentization";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:1;a:5:{s:4:"data";s:15:"Code Dependency";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:2;a:5:{s:4:"data";s:17:"code organization";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:3;a:5:{s:4:"data";s:14:"code structure";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:4;a:5:{s:4:"data";s:9:"Component";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:5;a:5:{s:4:"data";s:12:"Dependencies";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:6;a:5:{s:4:"data";s:16:"Dependency Cycle";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:7;a:5:{s:4:"data";s:17:"Dependency Matrix";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:8;a:5:{s:4:"data";s:5:"Layer";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:9;a:5:{s:4:"data";s:9:"namespace";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:10;a:5:{s:4:"data";s:7:"NDepend";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:44:"http://codebetter.com/patricksmacchia/?p=204";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:5115:"<p>Just a quick blog post to present a very concrete occurrence of Evolutionary Design + Levelization in action. I just stumbled on this occurrence after many days of large-scale refactoring. It was like the ice on the cake that concludes a lot of work. I presented the theory behind it in two previous blog posts, that will be refactored into a white book during the next few months: <a href="http://codebetter.com/patricksmacchia/2009/02/15/re-factoring-re-structuring-and-the-cost-of-levelizing/" target="_blank">Re-factoring, Re-Structuring and the cost of Levelizing</a> and <a href="http://codebetter.com/patricksmacchia/2009/02/22/evolutionary-design-and-acyclic-componentization/" target="_blank">Evolutionary Design and Acyclic componentization</a> (to be read in this order).</p>
<p>So basically a lot of refactoring is actually occurring in the NDepend code base. Hundreds of types are moved, new namespaces are created, new abstractions are created too to respect the Acyclic componentization principle. All this work is almost automatic, almost no brain is solicited. The work is only guided by primary design decisions like, this feature set cannot be directly used by this one, this feature set is about to be shared, this one will be top-level, this one will be low-level. The origin of these decisions is to append a huge new features set (already developed as a prototype and then refined) to the product. This new features set represents more than 10% of the actual entire product weight in terms of Lines of Code.</p>
<p>I was about to conclude one of the major step when I noticed that impacted components were not totally levelized. Two of them were actually dependent on each other. This problem was revealed by a pesky black cell on the Dependency Structure Matrix.</p>
<p><a href="http://cdn1.codebetter.com/patricksmacchia/files/2011/02/Matrix1.png"><img class="alignnone size-full wp-image-208" src="http://cdn1.codebetter.com/patricksmacchia/files/2011/02/Matrix1.png" alt="" width="590" height="348" /></a></p>
<p>So both namespaces <strong>CQ.InternalAPI</strong> and <strong>CQ.InternalAPI.Edition</strong> were mutually dependent. So I opened the dependency (<em>right click one of the black cell &gt; Open this Dependency</em>) and obtained the following Dependency Matrix.</p>
<p><a href="http://cdn1.codebetter.com/patricksmacchia/files/2011/02/Matrix2.png"><img class="alignnone size-full wp-image-210" src="http://cdn1.codebetter.com/patricksmacchia/files/2011/02/Matrix2.png" alt="" width="600" height="479" /></a></p>
<p>An interface from the namespace <strong>CQ.InternalAPI.Edition </strong>is using the enumeration <strong>QueryEditionOptions </strong>from the namespace <strong>CQ.InternalAPI</strong>. Clearly, the enumeration <strong>QueryEditionOptions </strong>is related to the query edition semantic. So obviously, to remove the cycle I just have to bubble up the enumeration <strong>QueryEditionOptions </strong>from <strong>CQ.InternalAPI </strong>to<strong> </strong><strong>CQ.InternalAPI.Edition</strong><strong>. </strong>Because an enumeration is not using any other type than primitive .NET numeric types, I don&#8217;t even have to check if <strong>QueryEditionOptions </strong>is using anything from the namespace <strong>CQ.InternalAPI</strong> (else, the move wouldn&#8217;t necessarily remove the dependency from <strong>CQ.InternalAPI.Edition</strong> to <strong>CQ.InternalAPI.Edition</strong>).</p>
<p><a href="http://cdn1.codebetter.com/patricksmacchia/files/2011/02/SlnExplorer_.png"><img src="http://cdn1.codebetter.com/patricksmacchia/files/2011/02/SlnExplorer_.png" alt="" width="345" height="254" /></a></p>
<p>All in all, it took less than 5 minutes to discover and fix the issue. But I found this tiny issue being a good occurrence to illustrate the power of <em>evolutionary design</em> applied conjointly with <em>component </em>levelization.</p>
<p>Before performing a major refactoring, one just has to do impact analysis. From this analysis one has enough information to take the adequate new design decisions. These design decisions modelize what will the application architecture look alike once the refactoring done. Applying the design decisions is then just a matter of doing automatic actions. This actions are mainly made of: moving types accross namespaces, create/delete namespaces, create/delete abstractions. The beauty is that as long as the structure is kept levelized, the process is powerful enough to spot automatically mistakes such as having <strong>QueryEditionOptions </strong>living outside the namespace <strong>CQ.InternalAPI.Edition</strong>.</p>
<p>As said in a previous post, by keeping components levelized, like in traditional building architecture, the structure itself put the pressure on low level components. Like in traditional building architecture, the structure won’t collapse. Applying this simple tenet for years, it now seems to me that this completely solves the problem of maintaining code over time.</p><img src="http://feeds.feedburner.com/~r/CodeBetter/~4/mOG1CyZognM" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:15:"patricksmacchia";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:105:"http://codebetter.com/patricksmacchia/2011/02/15/the-beauty-of-evolutionary-design-and-levelization/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:100:"http://codebetter.com/patricksmacchia/2011/02/15/the-beauty-of-evolutionary-design-and-levelization/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:4;a:6:{s:4:"data";s:63:"
		
		
		
		
		
				
		
		
		
		
		
		
			
					
			
				
					";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:4:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:84:"Running cucumber tests against GWT/AppEngine in TeamCity, or “How to CI with UI”";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:57:"http://feedproxy.google.com/~r/CodeBetter/~3/4pHwiPalv1o/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:129:"http://codebetter.com/kylebaley/2011/02/10/running-cucumber-tests-against-gwtappengine-in-teamcity-or-how-to-ci-with-ui/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Thu, 10 Feb 2011 21:04:00 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:7:{i:0;a:5:{s:4:"data";s:3:"BDD";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:1;a:5:{s:4:"data";s:8:"BookedIN";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:2;a:5:{s:4:"data";s:22:"Continuous Integration";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:3;a:5:{s:4:"data";s:17:"Google App Engine";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:4;a:5:{s:4:"data";s:3:"GWT";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:5;a:5:{s:4:"data";s:4:"Java";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:6;a:5:{s:4:"data";s:8:"TeamCity";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:90:"http://codebetter.com/kylebaley/2011/02/03/a-reason-to-ui-test-or-how-to-fill-in-the-gaps/";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:12259:"<p><strong>Executive summary</strong>: Setting up automated UI tests for an GWT/AppEngine application using TeamCity for CI and Cucumber for the tests.</p>
<p>Settle in folks. I’ma feelin’ verbose…</p>
<p>Sometimes this “best tool for the job” schtick is a royal pain in the raccoon when it comes to putting them together. We chose Google Web Toolkit because it is designed specifically for the type of app we want to build. Google App Engine made sense because of its integration with GWT. We went with Ruby/Cucumber for the UI tests because we recognized its power in this area and we were lucky enough to have a resource available to help guide us through the learning curve. For our CI server, we have TeamCity because…well, okay, I have no idea if it’s the best. It works well and I know how to use it. There’s only so much time you can spend for R&amp;D (outside of family reunions, at least).</p>
<p>I’ve been happy with all four pieces. GWT has proved its worth and we’ve been CI’ing for many months, happily compiling and running unit tests. The UI tests have been a bit slower to catch up but they work really well, especially lately since we’ve made a shift towards (what I think is) BDD.</p>
<p>We’ve been running the UI tests against a deployed version of the app on AppEngine, one specifically set aside for UI tests because from experience, trying to show someone the app while the UI tests are constantly clearing and resetting the data makes for a poor demo experience.</p>
<p>Recently, I’ve switched the tests over to run against devmode, which is a way of running a GWT/AppEngine app locally. Usually it’s used for debugging as it allows you to step through Java client code in an IDE.</p>
<h2>Why devmode?</h2>
<p>Running against a deployed version works reasonably well but has led to a good number of scenarios like:</p>
<p><em>Given I’m on the user form<br />
And I wait 2 seconds so the watermark has time to load</em><em><br />
And I fill in the password<br />
And I press “Save”<br />
And I wait 5 seconds so the screen can finish loading<br />
Then hopefully I’ll see a message at the top. But even if you do, mark the test failed anyway ‘cause the hillbilly has nothing better to do than rerun failing tests and watch them pass locally.</em></p>
<p>(&lt;Random deity&gt; bless Capybara for allowing me the freedom to write tests to express my *real* intent.)</p>
<p>That is, the tests needed to be told to pause every once in a while to allow things time to load. This isn’t to say the app is slow, just that computers are fast. And until we find a way to instantaneously populate a cascading dropdown, computers will continue to have an edge.</p>
<p>Devmode, on the other hand, is crazy fast if you don’t have it configured for debugging (i.e. you don’t add the gwt.codesvr parameter to the URL). It requires you to GWT compile the app first but hey, it’s a CI server; it can wait the extra three minutes to do that.</p>
<p>Another issue with this: using a deployed version requires the latest code to be deployed first. Granted, we have automated this in the CI server but it still adds fifteen to forty-five minutes to the process depending on how much bandwidth GoDaddy deems appropriate for our server on any given day.</p>
<p>Finally, there are quotas to consider. Every action on our application is logged and we have to be mindful of how much CPU time we’re using, how much bandwidth, how many emails get sent out, etc. At this stage, it’s unlikely we’ll reach those quotas but an errant test could potentially have costs associated with it.</p>
<p>So between the slow tests, the deployment time, and the potential cost, an obvious solution was to run the tests in devmode.</p>
<h2>Hosted mode/devmode</h2>
<p>If you create a GWT app with the built-in webAppCreator, you get a nice little Ant build file with a target that launches the app in devmode (nee hosted mode). I had to do some finagling to get it to work though. Here’s the final target in Ant (formatted to fit the width):</p>
<pre class="code"><span style="color: #bb5e00">&lt;target name=</span><span style="color: green">"devmode" </span><span style="color: #bb5e00">depends=</span><span style="color: green">"" </span><span style="color: #bb5e00">description=</span><span style="color: green">"Run development mode"</span><span style="color: #bb5e00">&gt;
  &lt;java fork=</span><span style="color: green">"true" </span><span style="color: #bb5e00">classname=</span><span style="color: green">"com.google.gwt.dev.DevMode"
    </span><span style="color: #bb5e00">dir=</span><span style="color: green">"${basedir}/war" </span><span style="color: #bb5e00">spawn=</span><span style="color: green">"true"</span><span style="color: #bb5e00">&gt;
    &lt;classpath&gt;
      &lt;pathelement location=</span><span style="color: green">"src" </span><span style="color: #bb5e00">/&gt;
      &lt;path refid=</span><span style="color: green">"project.class.path" </span><span style="color: #bb5e00">/&gt;
      &lt;path refid=</span><span style="color: green">"tools.class.path" </span><span style="color: #bb5e00">/&gt;
    &lt;/classpath&gt;
    &lt;jvmarg value=</span><span style="color: green">"-Xmx512M" </span><span style="color: #bb5e00">/&gt;
    &lt;jvmarg value=</span><span style="color: green">"-javaagent:${appengine.folder}/          lib/agent/appengine-agent.jar" </span><span style="color: #bb5e00">/&gt;
    &lt;jvmarg value=</span><span style="color: green">"-Duser.dir=${basedir}/WAR" </span><span style="color: #bb5e00">/&gt;
    &lt;arg line=</span><span style="color: green">"-war" </span><span style="color: #bb5e00">/&gt;
    &lt;arg value=</span><span style="color: green">"${basedir}/war" </span><span style="color: #bb5e00">/&gt;
    &lt;arg line=</span><span style="color: green">"-logLevel" </span><span style="color: #bb5e00">/&gt;
    &lt;arg value=</span><span style="color: green">"INFO" </span><span style="color: #bb5e00">/&gt;
    &lt;arg value=</span><span style="color: green">"-server" </span><span style="color: #bb5e00">/&gt;
    &lt;arg value=</span><span style="color: green">"com.google.appengine.tools</span></pre>
<pre class="code"><span style="color: green">        .development.gwt.AppEngineLauncher" </span><span style="color: #bb5e00">/&gt;
    &lt;arg value=</span><span style="color: green">"net.bookedin.bam.BAM" </span><span style="color: #bb5e00">/&gt;
  &lt;/java&gt;
&lt;/target&gt;
</span></pre>
<p>Most of this you can glean yourself if you look at the arguments tab of the GWT run <a href="http://kyle.baley.org/ct.ashx?id=3b70dab7-9a3f-45c5-9f90-b9bca5fa53cc&amp;url=http%3a%2f%2fkyle.baley.org%2fcontent%2fbinary%2fWindows-Live-Writer%2f02a3fa52d758_1384C%2fConfig_2.png"><img style="margin-top: 0px;margin-right: 0px;margin-bottom: 24px;margin-left: 0px;padding-left: 0px;padding-right: 0px;padding-top: 0px;border: 0px initial initial" src="http://kyle.baley.org/content/binary/Windows-Live-Writer/02a3fa52d758_1384C/Config_thumb.png" border="0" alt="Config" align="right" /></a>configuration in Eclipse. Some notes on discrepancies ‘twixt this and the default one:</p>
<h3>AppEngine support</h3>
<p>The second <span style="font-family: 'Courier New'">&lt;jvmarg&gt;</span> and the second and third last <span style="font-family: 'Courier New'">&lt;arg&gt;</span> values are included to support AppEngine. In some recent upgrade to AppEngine, the javaagent JVM argument was added.</p>
<h3>Changing the working directory</h3>
<p>If you leave the working directory as is, you’ll get a warning that the working directory doesn’t match the WAR directory. In most cases, this won’t matter. For us, we have files we wish to access so we need the working directory to match in order to access them.</p>
<p>To do this, we added the dir attribute to the <span style="font-family: 'Courier New'">&lt;java&gt;</span> task and added the last <span style="font-family: 'Courier New'">&lt;jvmarg&gt;</span> argument. We also updated the argument value for the –war parameter.</p>
<h3>Logging</h3>
<p>When you launch the app, the logLevel parameter needs to match what’s in your web.xml file.</p>
<h3>Spawn=”true”</h3>
<p>I’ll come back to this.</p>
<h2>Running the UI tests</h2>
<p>This wasn’t much of an issue. We run our UI tests with cucumber in Ruby. From what I can tell, it’s a standard implementation. And TeamCity supports it natively. Set Rake as the runner and run your cucumber task like you normally would.</p>
<h2>Killing dev mode</h2>
<p>The reason we added <span style="font-family: 'Courier New'">spawn=”true”</span> to the <span style="font-family: 'Courier New'">&lt;java&gt;</span> task above is to allow the Ant task to actually finish once devmode is launched. Without it, the process waits until devmode is finished before allowing you to continue. Which means it won’t go on to the next step in the CI process: running the UI tests.</p>
<p>Because of this, we needed a way of killing devmode after it had been started:</p>
<pre class="code"><span style="color: #bb5e00">&lt;target name=</span><span style="color: green">"kill"</span><span style="color: #bb5e00">&gt;
      &lt;exec executable=</span><span style="color: green">"taskkill"</span><span style="color: #bb5e00">&gt;
          &lt;arg value=</span><span style="color: green">"/fi"</span><span style="color: #bb5e00">/&gt;
          &lt;arg value=</span><span style="color: green">'"Windowtitle eq GWT Development Mode"'</span><span style="color: #bb5e00">/&gt;
      &lt;/exec&gt;
&lt;/target&gt;
</span></pre>
<h2>Putting it together</h2>
<p>This was harder than one might expect and we still don’t quite have it right. We now have three TeamCity build configurations, one for each step above:</p>
<ul>
<li>Launch devmode</li>
<li>Run tests</li>
<li>Kill devmode</li>
</ul>
<p>“Run tests” is configured to run upon a successful “Launch devmode” build. And “Kill devmode” runs upon any build, successful or otherwise, of “Run tests”.</p>
<p>Note that as of TeamCity 6, you can have multiple build steps per configuration. And indeed, my first pass at this was one configuration with three build steps. But as per <a href="http://confluence.jetbrains.net/display/TCD6/Configuring+Build+Steps">the documentation</a>: <strong>If a build step fails the rest are not executed.</strong></p>
<p>This automatically means “Kill devmode” has to be a separate configuration because I don’t want devmode hanging around active if any of the tests fail. (Alternatively, I could configure the build not to fail if any tests fail but…c’mon!)</p>
<p>The reason we separated the first two steps is that the Java code lives in a separate repository than the UI test scenarios. If we combine the two steps, then we need to pull both repositories. This is fine but I also want to configure the build to launch when code is checked in on only one of them, not both. By separating the steps, the first runs on one repository and the second on another. So I can configure the first to run whenever any Java code is checked in.</p>
<p>But this doesn’t work either. The UI tests take about forty minutes to run (which, I should note, is half an hour shorter than they did against the deployed version of the app). If any code is checked in during that forty minutes, “Launch devmode” will kick off again and fail miserably.</p>
<p>That said, I’ve just now thought of a better solution that I will try the minute I click Publish. We already have a build configuration that runs the unit tests. I’m going to combine the first two steps into a single configuration again and make it contingent on a successful build of <em>that</em> configuration. That way, even if someone checks in code while the UI tests are running, it won’t launch devmode until the UI tests are done because they’re both part of the same configuration.</p>
<p>I’m skipping a whole lot of details here so if you’re interested, ping me in the comments or offline.</p>
<p>As Joe Jackson says in Happy, Loving Couples: Right, that’s enough.</p>
<p>Kyle the Configurated</p><img src="http://feeds.feedburner.com/~r/CodeBetter/~4/4pHwiPalv1o" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:10:"Kyle Baley";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:125:"http://codebetter.com/kylebaley/2011/02/10/running-cucumber-tests-against-gwtappengine-in-teamcity-or-how-to-ci-with-ui/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:120:"http://codebetter.com/kylebaley/2011/02/10/running-cucumber-tests-against-gwtappengine-in-teamcity-or-how-to-ci-with-ui/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:5;a:6:{s:4:"data";s:45:"
		
		
		
		
		
				
			
					
			
				
					";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:4:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:38:"Ubuntu Server Setup with Python Fabric";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:57:"http://feedproxy.google.com/~r/CodeBetter/~3/AqbEgj4oJq0/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:97:"http://codebetter.com/brendantompkins/2011/02/07/ubuntu-server-setup-with-python-fabric/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Mon, 07 Feb 2011 19:16:21 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:1:{i:0;a:5:{s:4:"data";s:13:"Uncategorized";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:44:"http://codebetter.com/brendantompkins/?p=827";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:7607:"<p>On my journey to figure out how to host CodeBetter.Com under Ubuntu Linux/Wordpress, I stumbled (via <a href="http://codebetter.com/drusellers">Dru&#8217;s</a> excellent sage advice) upon the <a href="http://docs.fabfile.org/0.9.3/">Python library Fabric</a> to automate setup of the servers.  From the Fabric docs :</p>
<blockquote><p>Fabric is a Python library and command-line tool for streamlining the use of SSH for application deployment or systems administration tasks.</p>
<p>It provides a basic suite of operations for executing local or remote shell commands (normally or via <tt>sudo</tt>) and uploading/downloading files, as well as auxiliary functionality such as prompting the running user for input, or aborting execution.</p></blockquote>
<p>I spent about two weeks tweaking my fabric scripts to setup each of the servers in <a href="http://codebetter.com/brendantompkins/2011/02/07/cloud-hosting-codebetter-com-2/">CodeBetter&#8217;s cloud setup</a>.   If you&#8217;ve not tried cloud hosting you should.   It&#8217;s stupidly simple to stand up a new server (just a click of a button), pay for only what you need, scale servers up and down, and cancel at any moment.   But cloud hosting and automated configuration management go hand in hand.   What good is it being able to spin up a new instance at a moments notice if you have to spend hours configging it?</p>
<p>The process was really fun, and opened my eyes as to what&#8217;s possible with automated configuration management.  Everything, from OS updating to user account creation to deployment of content is done via Fabric.  For example, here&#8217;s a gist of the method used to create a new user :</p>
<script src="http://gist.github.com/814870.js"></script><noscript><link rel="stylesheet" href="https://gist.github.com/stylesheets/gist/embed.css"><div id="gist-814870" class="gist">
  
  
    
      
                

        <div class="gist-file">
          <div class="gist-data gist-syntax">
            
            
            
              <div class="highlight"><pre><div class='line' id='LC1'><span class="k">def</span> <span class="nf">new_user</span><span class="p">(</span><span class="n">admin_username</span><span class="p">,</span> <span class="n">admin_password</span><span class="p">):</span>   </div><div class='line' id='LC2'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">env</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="s">&#39;root&#39;</span></div><div class='line' id='LC3'>&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC4'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c"># Create the admin group and add it to the sudoers file</span></div><div class='line' id='LC5'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">admin_group</span> <span class="o">=</span> <span class="s">&#39;admin&#39;</span></div><div class='line' id='LC6'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">runcmd</span><span class="p">(</span><span class="s">&#39;addgroup {group}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">admin_group</span><span class="p">))</span></div><div class='line' id='LC7'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">runcmd</span><span class="p">(</span><span class="s">&#39;echo &quot;%{group} ALL=(ALL) ALL&quot; &gt;&gt; /etc/sudoers&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span></div><div class='line' id='LC8'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">group</span><span class="o">=</span><span class="n">admin_group</span><span class="p">))</span></div><div class='line' id='LC9'>&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC10'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c"># Create the new admin user (default group=username); add to admin group</span></div><div class='line' id='LC11'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">runcmd</span><span class="p">(</span><span class="s">&#39;adduser {username} --disabled-password --gecos &quot;&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span></div><div class='line' id='LC12'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">username</span><span class="o">=</span><span class="n">admin_username</span><span class="p">))</span></div><div class='line' id='LC13'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">runcmd</span><span class="p">(</span><span class="s">&#39;adduser {username} {group}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span></div><div class='line' id='LC14'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">username</span><span class="o">=</span><span class="n">admin_username</span><span class="p">,</span></div><div class='line' id='LC15'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">group</span><span class="o">=</span><span class="n">admin_group</span><span class="p">))</span></div><div class='line' id='LC16'>&nbsp;&nbsp;&nbsp;&nbsp;</div><div class='line' id='LC17'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="c"># Set the password for the new admin user</span></div><div class='line' id='LC18'>&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">runcmd</span><span class="p">(</span><span class="s">&#39;echo &quot;{username}:{password}&quot; | chpasswd&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span></div><div class='line' id='LC19'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">username</span><span class="o">=</span><span class="n">admin_username</span><span class="p">,</span></div><div class='line' id='LC20'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="n">password</span><span class="o">=</span><span class="n">admin_password</span><span class="p">))</span></div></pre></div>
            
          </div>

          <div class="gist-meta">
            <a href="https://gist.github.com/raw/814870/d9f18fcf4ea003a65f2d52ca776d71620c895842/Fabric-UserSetup.py" style="float:right;">view raw</a>
            <a href="https://gist.github.com/814870#file_fabric_user_setup.py" style="float:right;margin-right:10px;color:#666">Fabric-UserSetup.py</a>
            <a href="https://gist.github.com/814870">This Gist</a> brought to you by <a href="http://github.com">GitHub</a>.
          </div>
        </div>
      
    
  
</div>
</noscript>
<p>You can get the <a href="https://github.com/btompkins/CodeBetter.Com-Fabric">Fabric project to setup our servers here</a>.  Here&#8217;s a short screencast showing the Fabric deployment of our frontend NGINX reverse proxy server:</p>
<p><object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="437" height="392" id="viddler_ff682176"><param name="movie" value="http://www.viddler.com/player/ff682176/" /><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="true" /><embed src="http://www.viddler.com/player/ff682176/" width="437" height="392" type="application/x-shockwave-flash" allowScriptAccess="always" allowFullScreen="true" name="viddler_ff682176"></embed></object></p>
<p>Having our setup in Fabric scripts is also a great comfort.  Since it&#8217;s automated, it&#8217;s also documented and repeatable.  Should we find ourselves being slashdotted someday, we can simply spin up a new app tier host, run it&#8217;s related fabric configuration script and then tear it down when we&#8217;re back to normal traffic.  </p>
<p>-Brendan</p><img src="http://feeds.feedburner.com/~r/CodeBetter/~4/AqbEgj4oJq0" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:16:"Brendan Tompkins";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:93:"http://codebetter.com/brendantompkins/2011/02/07/ubuntu-server-setup-with-python-fabric/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:88:"http://codebetter.com/brendantompkins/2011/02/07/ubuntu-server-setup-with-python-fabric/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:6;a:6:{s:4:"data";s:45:"
		
		
		
		
		
				
			
					
			
				
					";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:4:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:28:"Cloud Hosting CodeBetter.Com";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:57:"http://feedproxy.google.com/~r/CodeBetter/~3/G-dSUVgouy0/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:89:"http://codebetter.com/brendantompkins/2011/02/07/cloud-hosting-codebetter-com-2/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Mon, 07 Feb 2011 17:58:33 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:1:{i:0;a:5:{s:4:"data";s:13:"Uncategorized";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:44:"http://codebetter.com/brendantompkins/?p=824";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:2461:"<p>It&#8217;s been over a year in the making, but CodeBetter.Com has finally settled into its new home.  It&#8217;s been a journey from Community Server, hosted on two large Windows 2008 servers (SQL Box - Core2Quad 2.4 Ghz Q6600 4G 2x500G SATA RAID, Web Server - Intel Core2Duo E6850 DC 2G 2x250G SATA RAID) to WordPress, running on 4 small cloud hosted Ubuntu 10.04 small Linux servers.  Our current architecture looks sorta like this:</p>
<p><a href="http://codebetter.com/brendantompkins/files/2011/02/codebetter.png"><img title="codebetter" src="http://codebetter.com/brendantompkins/files/2011/02/codebetter.png" alt="" width="550" height="405" /></a></p>
<p>Community Server running on Windows Server/ASP.Net has treated us well over the years, providing a solid platform on which we could grow to our current size.  Increasingly however, server cost, Software/OS/SQL Server licensing (while currently deferred via BizSpark and free licenses from Telligent) was threatening our future ability to provide the kind of community support we&#8217;ve been able to do since 2005.</p>
<p>We had a lot of internal discussions about what platform we should use, and talked about rolling our own platform from which to blog but decided against it.  I think <a href="http://devlicio.us/blogs/derik_whittaker/">Derik Whittaker</a>said it the best:</p>
<blockquote><p>The fact is &#8216;blog engines&#8217; are a dime a dozen.  This is  a boring problem which has been solved many times over&#8230; I say pick an engine that we can live with and move on.</p></blockquote>
<p>There were lots of factors that pushed us in the direction of hosting with an open source blogging platform like WordPress, but some of the biggest were WordPress&#8217; strengths : an outstanding blogging platform with massive community support and extensibility via plugins.</p>
<p>I&#8217;m going to be doing a series of posts on the more interesting things I&#8217;ve stumbled across in this journey, like using Python Fabric for automating the configuration of new server instances. I&#8217;m also making all of the tools that I&#8217;ve used and source code for the site itself<a href="https://github.com/btompkins">available up on GitHub</a>, so if you&#8217;re interested in how anything around here was done, you should be able to glean the information there.</p>
<p>-Brendan</p><img src="http://feeds.feedburner.com/~r/CodeBetter/~4/G-dSUVgouy0" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:16:"Brendan Tompkins";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:85:"http://codebetter.com/brendantompkins/2011/02/07/cloud-hosting-codebetter-com-2/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:80:"http://codebetter.com/brendantompkins/2011/02/07/cloud-hosting-codebetter-com-2/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:7;a:6:{s:4:"data";s:45:"
		
		
		
		
		
				
			
					
			
				
					";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:4:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:25:"A thought on Hard vs Soft";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:57:"http://feedproxy.google.com/~r/CodeBetter/~3/7-PMxfVR2ik/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:79:"http://codebetter.com/drusellers/2011/02/06/a-thought-on-hard-vs-soft/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Sun, 06 Feb 2011 17:37:26 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:1:{i:0;a:5:{s:4:"data";s:11:"Small Ideas";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:38:"http://codebetter.com/drusellers/?p=93";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:889:"<p><a title="Frozen Stream by Eifion, on Flickr" href="http://www.flickr.com/photos/eifion/92701814/"><img src="http://farm1.static.flickr.com/35/92701814_87cc69317c_m.jpg" alt="Frozen Stream" width="240" height="180" /></a></p>
<p>With the move from <strong>RDBMS</strong> to <strong>NoSQL</strong> are we seeing the same shift that we saw when we moved from <strong>Hardware</strong> to <strong>Software</strong>. Are we seeing a shift from <strong>Harddata</strong> to <strong>Softdata</strong>?</p>
<blockquote>
<p>Water is fluid, soft and yielding. But water will wear away rock, which is rigid and cannot yield. As a rule, whatever is fluid, soft and yielding will overcome whatever is rigid and hard. This is another paradox: what is soft is strong.</p>
<p><em>Lao-tzu</em></p></blockquote><img src="http://feeds.feedburner.com/~r/CodeBetter/~4/7-PMxfVR2ik" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:11:"Dru Sellers";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:75:"http://codebetter.com/drusellers/2011/02/06/a-thought-on-hard-vs-soft/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:70:"http://codebetter.com/drusellers/2011/02/06/a-thought-on-hard-vs-soft/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:8;a:6:{s:4:"data";s:45:"
		
		
		
		
		
				
			
					
			
				
					";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:4:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:9:"What fun!";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:57:"http://feedproxy.google.com/~r/CodeBetter/~3/w7FiLBssqps/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:62:"http://codebetter.com/drusellers/2011/02/05/what-fun/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Sat, 05 Feb 2011 17:13:48 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:1:{i:0;a:5:{s:4:"data";s:11:"Small Ideas";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:38:"http://codebetter.com/drusellers/?p=91";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:552:"<blockquote>
<p>It goes against the grain of modern education to teach children to program. What fun is there in making plans, acquiring discipline in organizing thoughts, devoting attention to detail and learning to be self-critical?</p>
<p>Alan Perlis, Epigrams in Programming</p>
</blockquote>
<p>I just love that quote.</p>
<p>via: <a href="http://htdp.org/2003-09-26/Book/curriculum-Z-H-2.html">http://htdp.org/2003-09-26/Book/curriculum-Z-H-2.html</a></p><img src="http://feeds.feedburner.com/~r/CodeBetter/~4/w7FiLBssqps" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:11:"Dru Sellers";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:58:"http://codebetter.com/drusellers/2011/02/05/what-fun/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:53:"http://codebetter.com/drusellers/2011/02/05/what-fun/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:9;a:6:{s:4:"data";s:45:"
		
		
		
		
		
				
			
					
			
				
					";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:4:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:53:"A reason to UI test, or “How to fill in the gaps”";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:57:"http://feedproxy.google.com/~r/CodeBetter/~3/Zr3t0dxhCTA/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:101:"http://codebetter.com/kylebaley/2011/02/03/a-reason-to-ui-test-or-how-to-fill-in-the-gaps-2/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Thu, 03 Feb 2011 16:31:25 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:1:{i:0;a:5:{s:4:"data";s:13:"Uncategorized";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:92:"http://codebetter.com/kylebaley/2011/02/03/a-reason-to-ui-test-or-how-to-fill-in-the-gaps-2/";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:6069:"<p>Dja miss me? Of course not. You’re reading this in an RSS reader and if I hadn’t asked the question, you wouldn’t have noticed I was gone. If you’re like me, you’re scanning through until you can find any reason to skip this post and move on to the next one. Here, I’ll help your little mental filter:</p>
<p><strong>Executive summary</strong>: An example of when UI/integration tests succeed where unit tests don’t.</p>
<p>But I’m warning ya, you’ll miss out on the amusing delivery if you go by this alone.</p>
<h2>Pre-amble</h2>
<p>We are tantalizingly close to coming out of trial mode with <a href="http://corp.bookedin.net" target="_blank">BookedIN</a>. My business partner had a nice little debate for our development process after its out. His stance: we need to write UI tests before we write code to avoid a lot of the issues that were arising. My stance: We unit test the ever-living raccoons out of the app now (thanks in no small part to <a href="http://code.google.com/p/jukito/" target="_blank">Jukito</a>). And we <em>do</em> have a UI testing process that was used for major features. While I agreed that we should have more, I was leery that it would make us any more productive. And I doubted it would help us discover any more issues than we already were…</p>
<p><em>(Ed. note: Did you notice the ellipsis at the end of that last paragraph? That’s what we in the legitimate journalism field call foreshadowing. Or, as is more often the case in my writing, foreboding. Note that you won’t see classy tropes like this from those hacks at <a href="http://www.lostechies.com" target="_blank">Los Techies</a>.)*</em></p>
<h2>The bug</h2>
<p>When someone logs into the application, there are a number of notifications that could pop up in various scenarios:</p>
<ul>
<li>Owner logging in for the first time: Enter company details, following by a welcome message
<li>New staff member: welcome message
<li>Owner after the first time: You haven’t verified your email address yet (assuming it hasn’t, in fact, been verified)
<li>Anyone after the trial period has expired: Message that says “Just kidding, you don’t have to pay! Tee hee to those that did.”
<li>Existing users after a major release: What’s new! </li>
</ul>
<p>There might be more, you can’t expect me to keep all this &amp;*^% in my head.<a href="http://codebetter.com/kylebaley/files/2011/02/BookedIN.png"><img style="border-right-width: 0px;padding-left: 0px;padding-right: 0px;float: right;border-top-width: 0px;border-bottom-width: 0px;border-left-width: 0px;padding-top: 0px" border="0" alt="BookedIN" align="right" src="http://codebetter.com/kylebaley/files/2011/02/BookedIN_thumb.png" width="244" height="134"></a></p>
<p>We covered all of this with a NotificationController. It would determine what conditions were met and start piling messages into a queue and display them in order. All of it <em>very </em>thoroughly tested with unit tests to make sure repositories were called and messages sent and users updated and so on and so forth.</p>
<p>The bug as listed was: When they log out and re-log in, users are seeing the what’s new message again.</p>
<p>As with most bugs, this was an oversimplication. As I tested, I discovered that this would happen intermittently. Sometimes it would happen as stated. Sometimes a new owner would enter her company details, log out, log in again, then see the company details window once more. Sometimes it would just work.</p>
<h2>The analysis</h2>
<p>“How can this be?” says I. The tests clearly outline what is supposed to happen and the code clearly passes all the tests.</p>
<p>As mentioned, we have a UI testing framework in place and used it on occasion. The reason it is not used more frequently is a topic that is already half-written but the short answer is: Google Web Toolkit adds some hurdles we haven’t had time to overcome yet. But given our recent debate, I fired up Notepad and banged out a capybara scenario. Nine times out of ten, it would fail. Except when I ran through the debugger in which case ten times out of ten, it would succeed.</p>
<h2>The culprit</h2>
<p>A good, old-fashioned race condition. In our client piece, the code for the first notification scenario above reads like this (it’s in pseudo-code because I don’t actually code anymore…):</p>
<p>if (logging_in_for_the_first_time) { <br />&nbsp;&nbsp;&nbsp; showWelcomeMessage( ); <br />&nbsp;&nbsp;&nbsp; markWhatsNewMessageAsSeen( ); <br />}</p>
<p>Judicious use of logging revealed the following exchange on the server:</p>
<p>[MarkingWelcomeMessageSeen] Starting execution <br />[MarkingWelcomeMessageSeen] Retrieving user details <br />[MarkingWelcomeMessageSeen] Marking welcome message seen <br />[MarkingWhatsNewMessageSeen] Starting execution <br />[MarkingWhatsNewMessageSeen] Retrieving user details <br />[MarkingWhatsNewMessageSeen] Marking what’s new message seen <br />[MarkingWelcomeMessageSeen] Saving user <br />[MarkingWhatsNewMessageSeen] Saving user</p>
<p>After making a mental note to perhaps differentiate my method names a little better, it was painfully obvious what the problem was.</p>
<h2>The solution</h2>
<p>That’s not the topic of this post. Focus, Hillbilly!</p>
<h2>The moral</h2>
<p>As I said, all unit tests passed. Our tests on the client proved that we were marking the messages seen in the appropriate conditions. Tests for the server component show that we are calling repositories and setting properties (or the Java equivalent: setting properties, but with more code) properly.</p>
<p>But the problem didn’t manifest itself until we did the UI test (or integration test, if you prefer).</p>
<p>So folks, heed my warning. A lack of decent integration/UI tests can lead to a smug and self-righteous business partner.</p>
<p>Kyle the Humbled</p>
<p><font size="1">* shiny nickel for those of you who recognize this little bit being ripped off from Bloom County</font></p><img src="http://feeds.feedburner.com/~r/CodeBetter/~4/Zr3t0dxhCTA" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:10:"Kyle Baley";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:97:"http://codebetter.com/kylebaley/2011/02/03/a-reason-to-ui-test-or-how-to-fill-in-the-gaps-2/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:92:"http://codebetter.com/kylebaley/2011/02/03/a-reason-to-ui-test-or-how-to-fill-in-the-gaps-2/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:10;a:6:{s:4:"data";s:45:"
		
		
		
		
		
				
			
					
			
				
					";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:4:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:57:"The appstore, iOs versions and Monotouch (4.0 won’t do)";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:57:"http://feedproxy.google.com/~r/CodeBetter/~3/EIa5RQWbR5o/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:109:"http://codebetter.com/petervanooijen/2011/02/03/the-appstore-ios-versions-and-monotouch-4-0-wont-do/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Thu, 03 Feb 2011 10:21:11 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:1:{i:0;a:5:{s:4:"data";s:13:"Uncategorized";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:100:"http://codebetter.com/petervanooijen/2011/02/03/the-appstore-ios-versions-and-monotouch-4-0-wont-do/";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:1630:"<p>iOs, the iPhone/iPad OS is changing rapidly. Version 4.0 recently brought multi tasking and the like, a big update. It didn’t work that well with older iPhones, soon it was replaced by 4.1. Shortly after came 4.2 and 4.3 is already in beta. This has consequences when building apps. These are greater than having the opportunity to do new things and the necessity to test your apps on the new versions. As I found out when trying to submit a Monotouch app to the store. It was rejected stating “Currently we do not accept apps for this SDK version”. At first sight you might want to blame Monotouch. Things were a little different.</p>
<p>With every version of iOS comes a version of the SDK. This SDK is part of the iOs development tools. Monotouch works on top of those. Before installing MT you need to install them. At the time I did that, iOs was at version 4.0. The bad thing about the iOs SDK is that it does not check for updates; without being really aware of that I was still working in 4.0. It was not until submitting the app that I found out. The good thing is that you are notified the moment you are uploading the app. It is part of the first automatic scan of the app. Interesting (and good) Apple rejects 4.0.</p>
<p>I had to download and reinstall the SDK tools again (huge!). Having done that triggered MT automatically to update itself. After a test of the app (everything still worked) I tried to submit to the store again. No problem. So the Apple SDK, not updating itself, was the bad guy. Not Monotouch.</p><img src="http://feeds.feedburner.com/~r/CodeBetter/~4/EIa5RQWbR5o" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:16:"Peter van Ooijen";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:105:"http://codebetter.com/petervanooijen/2011/02/03/the-appstore-ios-versions-and-monotouch-4-0-wont-do/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:100:"http://codebetter.com/petervanooijen/2011/02/03/the-appstore-ios-versions-and-monotouch-4-0-wont-do/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:11;a:6:{s:4:"data";s:48:"
		
		
		
		
		
				
		
			
					
			
				
					";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:4:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:38:"MSDN Magazine Pivot Viewer Source Code";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:57:"http://feedproxy.google.com/~r/CodeBetter/~3/D2cwVneibgM/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:96:"http://codebetter.com/howarddierking/2011/02/03/msdn-magazine-pivot-viewer-source-code/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Thu, 03 Feb 2011 04:50:16 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:2:{i:0;a:5:{s:4:"data";s:13:"MSDN Magazine";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:1;a:5:{s:4:"data";s:5:"Pivot";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:87:"http://codebetter.com/howarddierking/2011/02/03/msdn-magazine-pivot-viewer-source-code/";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:861:"<p>Now that I’ve finished the blog series detailing how I created the MSDN Magazine Pivot collection, I wanted to quickly let you know that I’ve made all of the source code available on bitbucket at <a href="https://bitbucket.org/howarddierking/msdnmagpivot-public">https://bitbucket.org/howarddierking/msdnmagpivot-public</a>.&nbsp; </p>
<p>One bit of noise in that project to be aware of is that I’m in the early stages of replacing the <a href="http://codebetter.com/howarddierking/2010/10/28/generating-the-collection-data/">SSIS plumbing</a> that I am currently using to wire together my collection building process with <a href="http://ayende.com/Blog/category/545.aspx">Rhino ETL</a>.&nbsp; However, I’m in the early stages here and the code is sparse.</p><img src="http://feeds.feedburner.com/~r/CodeBetter/~4/D2cwVneibgM" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:15:"Howard Dierking";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:92:"http://codebetter.com/howarddierking/2011/02/03/msdn-magazine-pivot-viewer-source-code/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:87:"http://codebetter.com/howarddierking/2011/02/03/msdn-magazine-pivot-viewer-source-code/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:12;a:6:{s:4:"data";s:45:"
		
		
		
		
		
				
			
					
			
				
					";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:4:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:43:"Minting new Internet Media Type Identifiers";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:57:"http://feedproxy.google.com/~r/CodeBetter/~3/vhSJNZK1tF4/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:102:"http://codebetter.com/sebastienlambla/2011/02/01/minting-new-internet-media-type-identifiers/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Tue, 01 Feb 2011 15:51:01 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:1:{i:0;a:5:{s:4:"data";s:13:"Uncategorized";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:93:"http://codebetter.com/sebastienlambla/2011/02/01/minting-new-internet-media-type-identifiers/";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:11702:"<p>A lot of conversations have been had at #restunconf about minting a new media type, when you should do it and how. I’ll try to blog about it in the closer future, but a recent discussion on twitter is triggering a quick and dirty run-through of how, when you create a new Internet Media Type (sometimes inaccurately call content type or MIME type), you should create a media type identifier.</p>
<p><em>Note: all I’m discussing here has been around since 1996, 15 Internet years ago. If you find vendors not following those rules, it is your responsibility as a user of the Internet to notify them that their knowledge is probably the same age as their youngest employees.</em></p>
<h2>Back to basis</h2>
<p>A media type identifier is composed of three components: a content type, a content subtype and some parameters that can be specified.</p>
<p>For example, html is usually served as <strong>text/html</strong>, where the content type is text, and the content subtype is html. An example of a parameter you’ll encounter often is the <strong>charset</strong> parameter, as in <strong>text/html;charset=utf-8</strong>.</p>
<h2>Choosing the content type</h2>
<p>The first step in minting your media type identifier is to decide in which content type it belongs. The list is <a href="http://www.iana.org/assignments/media-types/">defined by the IANA</a>, and contains such things as text, audio, video, model and the well-known application.</p>
<p>Each of the IANA-defined content types have certain requirements that your media type need to conform to, and there’s a good reason for that: generic processing fall-back. When a user-agent (a browser or whatever you use as a web client) encounters a media type identifier it doesn’t understand specifically (say text/vnd.openwrap.descriptor), it can fall-back to the processing rule for the content type (text) and display things as if the format was actually text/plain. </p>
<p>Let’s review the two most contentious content types.</p>
<h3>text</h3>
<p>If the content of your media type can be shown as is, in notepad, with no control characters for formatting, and still be readable to humans, then it should belong in the text content type. This allows you to specify the encoding of such text using the <strong>charset</strong> attribute defined for the content type.</p>
<p>This is why plain text uses <strong>text/plain</strong>, html uses <strong>text/html</strong> and word documents are not served in the text branch: you can’t open those in notepad.</p>
<p>So why is xml served as application/xml rather than text/xml? The latter is registered, but comes with a bunch of restrictions: the default character set if not specified is ascii (as opposed to application/xml, where the default is handled by the XML specification), utf-16 and utf-32 are not allowed in the text content type (except when served in HTTP, do remember that media type identifiers are used in more places than HTTP).</p>
<p>More importantly, some systems do transcoding of character sets dynamically when mediating a communication to a text content type. The problem with XML is that you can override this inside the xml document using a prolog, and that may render the transcoding invalid (trying to convert utf-32 to utf-8 when the processing instruction defines the encoding as being windows-1252).</p>
<p>For those reasons, most systems keep xml as application/xml, alleviating most of the compatibility issues you’d run into otherwise.</p>
<h3>application</h3>
<p>The application content type is there for <strong>application-specific</strong> media types. This means that an application needs to handle that media type for it to be useful, and that the generic fall-back is to ask the user what to do with that stream of bytes (by defaulting to <strong>application/octet-stream</strong>).</p>
<p>This means that if you can put your media type in the <strong>text</strong> or <strong>image</strong> branches, you really should be doing that instead of using the application.</p>
<h2>Choosing a content subtype</h2>
<p>The reason why IANA keeps a registry of media types is so that people can find out what kind of document they’re receiving. The subtype lets the user-agent know what to do with a specific subtype, while preserving the generic processing of the parent type.</p>
<p>What do you need to do to register your own subtype? The answer is defined in <a href="http://www.ietf.org/rfc/rfc4288.txt?number=4288">[RFC4288]</a> and <a href="http://www.ietf.org/rfc/rfc4289.txt?number=4289">[RFC4289]</a>. To spare you a lengthy read, if you’re registering a subtype in the IETF branch (such as plain in <strong>text/plain</strong>), you’ll have to be going through a stringent standardization procedure that will question your registration and make it fit for purpose for the whole internet to use.</p>
<p>Not all media types, and certainly very few, if any, media type identifier you will mint for your own usage need to go through this long process, and that’s why the subtype itself is split into multiple trees.</p>
<p>The IETF (or stadnards) tree is the one we just discussed, and unless you want to invent the next ATOM format, you probably don’t need to care for it.</p>
<h3>The vendor tree</h3>
<p>For vendors, the registration is much more simplified. The way to register a vendor-specific media type is by prefixing your subtype with <strong>vnd.<em>vendorname.</em></strong><em> </em>For example, the descriptor format in OpenWrap will be registered as <em>text/vnd.openwrap.descriptor. </em>If you however have a very well-known application, you may wish to register without the vendor name, as in <em>text/vnd.msword</em>.</p>
<p>As an advice, registrations in the form <em>vnd.vendor.format</em> are usually less contentious than <em>vnd.producername</em>, so choose the former if you can.</p>
<p>Once you have defined your media type identifier to use the vendor branch, you can either stop there (and be a bad, bad Internet citizen), or you can submit your registration to the IANA for inclusion in their list. It’s optional but it’s better for everyone if you do.</p>
<h3>The vanity tree</h3>
<p>I just love the name <em>vanity</em> tree, also called the <em>personal</em> tree. It’s where you would put stuff you don’t really intend anyone but yourself to use, or where you put experiments in. As with the vendor tree, the registration is optional, and as with the vendor tree, you use a prefix, <strong>prs</strong>, as in <strong>application/prs.serialseb.odatadoneright</strong>.</p>
<h3>The x- or x. prefix</h3>
<p>This is the main reason why I wrote this blog entry. The x- or x. prefixes are only to be used for <em>“unregistered, experimental, and for use only with the active agreement of the parties exchanging them”</em>. To go one further, because we already have the vendor and vanity trees, <em>“use of both &#8220;x-&#8221; and &#8220;x.&#8221; forms is discouraged”</em>. </p>
<p>Be aware that <strong>I have no such agreement with anyone</strong>, so any time you create one of those atrocities, you’re in breach of the standard and using something no one wants. You’re invading my personal space. You’re leaving poo all over the internet carpet and I have no clue as to what the heck your format is, as it’s not registered anywhere.</p>
<p>In other words, don’t <strong>ever</strong> use x- or x. unless you want to look really silly or admit you’ve not read about web standards in the last 15 years. No ifs, no buts. Just don’t.</p>
<h2>Subtype suffixes</h2>
<p>This leaves us with suffixes. They were introduced with the XML specification to allow annotating subtypes that use the xml serialization, and are in the form <strong>+xml</strong>. The idea behind those is the same as with types and subtypes, allow for generic processing in case the specific one doesn’t work. It’s as such believed that if a user-agent doesn’t understand the <strong>application/xhtml+xml</strong> media type, then it should be able to fall-back on xml processing to display *something* to the client.</p>
<p>In practice, this is not implemented by many agents (although OpenRasta 3 will deal with those scenarios), but there you go: if you use XML for your custom media type, +xml is the way to go. There’s also some traction to registering the +json convention as well for those liking this format.</p>
<h2>Parameters</h2>
<p>Finally, parameters can be registered too at the same time as your media type identifier. There is also a lot of confusion around those, so let’s clear up some air.</p>
<p>First, you inherit all the parameters defined on the content type, That means that <strong>any</strong> text content type will <strong>always</strong> have charset as a defined parameter, be it that you like it or not.</p>
<p>If you want your own, you <strong>must</strong> register any parameter at the same time as your media type identifier. You can’t add them randomly without specifying them. You can’t change the nature of a media type registration by adding a parameter afterwards, even if you re-register your media type. If you did, any processing that used to be done on a media type would now become broken.</p>
<p>What you can do, as you version your media type identifier registrations (aka submit a new one), is to add information about what the media type is. Let’s see a concrete example of what non-breaking additional parameters can be registered.</p>
<p><em>Note that I wasn’t part of that standardization process, and didn’t actually read the conversations, but the rationale for what was done exposes my point, be it that the rationale is accurate or not.</em></p>
<p>When the application/atom+xml media type identifier was registered, there was no <em>entry</em> parameter. The media type identifier was to identify something containing atom, which could be a feed or an item, and it was up to an Atom processor to know the difference.</p>
<p>When AtomPub was standardized, there was a need to make a distinction between feed and item, something the original spec didn’t account for. At that stage, the Atom people had two scenarios: either mint a new media type identifier for entries, or add a parameter to the existing registration.</p>
<p>In the first scenario, you would end up with application/atom+xml, which could be either a feed or an item, and application/atom-entry+xml, which would be an entry. All previous processors understanding application/atom+xml, which could read feeds or items, wouldn’t understand the new media type identifier, even though they would understand the content of the media type. Incompatibility ensues.</p>
<p>When defining the type parameter, the new processors can make a distinction between feed and item if the entry parameter is present. If the new registration was changing the meaning of the media type to make the parameter mandatory, you’d have the same scenario as using a new media type: incompatibilities. But the guys writing the spec are smart: they indicate that in the absence of the type parameter, it’s business as usual, it can be either: you preserved compatibility with the previous agents.</p>
<h2>Conclusion</h2>
<p>Media type identifiers can look challenging, but they’re very powerful when used properly, and follow rules that are quite simple to understand. Registrations for vendors and users, when not going for standardization, is not mandatory but help the whole community. Adopt the correct identifier, let the IANA know and make the Internet a better place for everyone.</p><img src="http://feeds.feedburner.com/~r/CodeBetter/~4/vhSJNZK1tF4" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:16:"Sebastien Lambla";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:98:"http://codebetter.com/sebastienlambla/2011/02/01/minting-new-internet-media-type-identifiers/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:93:"http://codebetter.com/sebastienlambla/2011/02/01/minting-new-internet-media-type-identifiers/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:13;a:6:{s:4:"data";s:45:"
		
		
		
		
		
				
			
					
			
				
					";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:4:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:44:"C# for the iPhone: Monotouch is here to stay";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:57:"http://feedproxy.google.com/~r/CodeBetter/~3/YTCct-mpPWA/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:100:"http://codebetter.com/petervanooijen/2011/01/31/c-for-the-iphone-monotouch-is-here-to-stay/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Mon, 31 Jan 2011 11:58:11 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:1:{i:0;a:5:{s:4:"data";s:13:"Uncategorized";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:91:"http://codebetter.com/petervanooijen/2011/01/31/c-for-the-iphone-monotouch-is-here-to-stay/";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:2728:"<p>Today I’m going to submit my second <a href="http://monotouch.net/">Monotouch</a> app to the Appstore. Time to write down some reflections and try to further raise enthusiasm for Monotouch by providing some links.</p>
<ul>
<li>Apple does accept Monotouch apps in the store, look here for a <a href="http://monotouch.net/Apps">catalog</a> and <a href="http://monotouch.net/Apps/?tag=/Showcase">showcase</a> .</li>
<li>The default tool for building iOs app is Apple’s Xcode. Most resources on iOS devlopment are in xCode’s objective C. The Monotouch architecture closely mirrors Xcode, read the <a href="http://tirania.org/tmp/rosetta.html">Rosetta stone</a> to translate member names.</li>
</ul>
<p>But Monotouch is more than just another dialect. IMHO and experience the C# language and the .net class library do have unique things to offer. To name some:</p>
<ul>
<li>Generics</li>
<li>Lists. Unlike C# for Windows.net Lists <a href="http://codebetter.com/petervanooijen/2010/10/28/monotouch-your-c-app-on-a-real-iphone/">are a wrapper for arrays</a>. Using (typed) lists does lead to far clearer code.</li>
<li>Lambda’s and linq. Objective C (Xcode) does have delegate’s but misses the elegance of lambda’s.</li>
<li>XML. Both XmlDocument and Xpath work very well (and fast) in Monotouch. The way to go when doing interop.</li>
</ul>
<p>These are my favorite Monotouch sites</p>
<ul>
<li><a href="http://www.shrinkrays.net/">Shrinkrays</a>. Formerly known as sloppycode.net. A huge variety of articles and snippets. My favorite ones are on a <a href="http://www.shrinkrays.net/articles/monotouch-controllers-by-example.aspx">code based approach to views and controllers</a> on the iPhone. Most articles on the web guide you through the MonoDevelop wizards to start an app. Which leads to the world of interface builder and xib’s. The approach presented here focuses on the plain C# code behind and a surprisingly easy way to build a complete app from plain C#. I am working on a more elaborate post which builds on these ideas.</li>
<li><a href="http://conceptdev.blogspot.com/">Conceptdev</a> (Craig Dunn’s blog) More than just MonoTouch stuff. Craig has also worked on the <a href="http://deepearth.codeplex.com/">DeepEarth</a> project and in his most recent posts he is covering Windows Phone 7. Great source to put things in perspective. </li>
<li><a href="http://www.infoq.com/articles/monotouch-introduction">Infoq</a>. These are more traditional basic articles. The quality is great, I keep using the one <a href="http://www.infoq.com/articles/monotouch-custom-tables">on tables</a> again and again.</li>
</ul><img src="http://feeds.feedburner.com/~r/CodeBetter/~4/YTCct-mpPWA" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:16:"Peter van Ooijen";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:96:"http://codebetter.com/petervanooijen/2011/01/31/c-for-the-iphone-monotouch-is-here-to-stay/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:91:"http://codebetter.com/petervanooijen/2011/01/31/c-for-the-iphone-monotouch-is-here-to-stay/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:14;a:6:{s:4:"data";s:45:"
		
		
		
		
		
				
			
					
			
				
					";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:4:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:49:"Easier Debugging with ReSharper and the Clipboard";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:57:"http://feedproxy.google.com/~r/CodeBetter/~3/ylWqbvwojog/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:104:"http://codebetter.com/jameskovacs/2011/01/31/easier-debugging-with-resharper-and-the-clipboard/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Mon, 31 Jan 2011 16:00:00 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:1:{i:0;a:5:{s:4:"data";s:4:".NET";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:95:"http://codebetter.com/jameskovacs/2011/01/31/easier-debugging-with-resharper-and-the-clipboard/";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:4443:"<p>We’ve all done it at one point or another. Our application throws an exception and we start wading through a standard Windows error dialog or a log file to examine the exception and stack trace. If you’re a ReSharper Jedi, you’ve probably copied the exception and stack trace to the clipboard and hit CTRL-SHIFT-E (IDEA) or CTRL-E, T (VS) in Visual Studio to launch ReSharper’s Stack Trace Explorer. (If you have’t, you’ll see the Stack Trace Explorer in just a second.)</p>
<p>Let me show you an easier way that works well on desktop or Silverlight apps. I’ll use Silverlight for demo purposes, but the same technique works with WPF and WinForms. First we need to hook up a global error handler:</p>
<pre class="brush: csharp;">public MainPage() {
    InitializeComponent();
    Application.Current.UnhandledException += HandleApplicationUnhandledException;
}

private static void HandleApplicationUnhandledException(object sender, ApplicationUnhandledExceptionEventArgs e) {
    if(Debugger.IsAttached) {
        Clipboard.SetText(e.ExceptionObject.ToString());
    }
    e.Handled = false;
}</pre>
<p>Please note that this is demo code and I’m simply hooking this up in the code behind. In a larger application, I would typically publish an ErrorOccurred message to my application’s message bus and register a listener that would contain the code in HandleApplicationUnhandledException.</p>
<p>Notice that I’m checking whether a debugger is attached. If so, I place the contents of the System.Exception (or derived exception) on the clipboard. (Clipboard is in the System.Windows namespace for Silverlight and WPF apps, but there is an identically-named class in System.Windows.Forms.) The reason that I’m checking whether a debugger is attached is so that end-users don’t get the clipboards spammed with exception text. You could conditionally compile the code so that production builds don’t contain it, but personally I like having the code in production too. It means that I can grab an old build, attach a debugger, and get the same exceptions that the end users are getting.</p>
<p>Now that the exception and stack trace is on the clipboard, I jump over to Visual Studio and press CTRL-SHIFT-E (IDEA) or CTRL-E, T (VS). I am immediately presented with ReSharper’s Stack Trace Explorer as ReSharper is smart enough to grab the current clipboard contents to display:</p>
<p><img style="border-right-width: 0px;margin: 0px 0px 24px;padding-left: 0px;padding-right: 0px;border-top-width: 0px;border-bottom-width: 0px;border-left-width: 0px;padding-top: 0px" border="0" alt="StackTraceExplorer" src="http://codebetter.com/jameskovacs/files/2011/01/StackTraceExplorer.png" width="480" height="481"></p>
<p>The advantage here is fictionless debugging as you no longer have to find, select, and copy the exception and stack trace to the clipboard. It’s there for you automatically. As soon as you hit an exception, simply jump to Visual Studio and press CTRL-SHIFT-E (IDEA) or CTRL-E, T (VS) and you’re ready to find the problem. Also note that all the method names in the ReSharper’s Stack Trace Explorer are hot links to the appropriate code file allowing for easy navigation of your code base, the .NET Framework, and third-party libraries.</p>
<p>One quick note regarding Silverlight… Many modern browsers (e.g. FF4, IE8+, Chrome, …) will run Silverlight in a separate process. So even when you launch with debugging (F5), you’ll be attached to the browser process itself and not the child process that is hosting Silverlight. To correct this, simply go to Debug… Attach to Process… and find the hosting process where the type is Silverlight. (For FireFox 4, the hosting process is called plugin-container.exe. For IE8+ and Chrome, the hosting process is called iexplore.exe or chrome.exe, respectively. Just look for the one hosting Silverlight as noted under the “Type” column.)</p>
<p><a href="http://codebetter.com/jameskovacs/files/2011/01/AttachToProcess.png"><img style="border-right-width: 0px;padding-left: 0px;padding-right: 0px;border-top-width: 0px;border-bottom-width: 0px;border-left-width: 0px;padding-top: 0px" border="0" alt="AttachToProcess" src="http://codebetter.com/jameskovacs/files/2011/01/AttachToProcess_thumb.png" width="640" height="439"></a></p>
<p>Happy Debugging!</p><img src="http://feeds.feedburner.com/~r/CodeBetter/~4/ylWqbvwojog" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:12:"James Kovacs";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:100:"http://codebetter.com/jameskovacs/2011/01/31/easier-debugging-with-resharper-and-the-clipboard/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:95:"http://codebetter.com/jameskovacs/2011/01/31/easier-debugging-with-resharper-and-the-clipboard/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:15;a:6:{s:4:"data";s:45:"
		
		
		
		
		
				
			
					
			
				
					";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:4:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:33:"Announcing the new ATX Code Lunch";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:57:"http://feedproxy.google.com/~r/CodeBetter/~3/WT0zBWBVZLY/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:89:"http://codebetter.com/jeremymiller/2011/01/28/announcing-the-new-atx-code-lunch/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Sat, 29 Jan 2011 01:17:26 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:1:{i:0;a:5:{s:4:"data";s:13:"Uncategorized";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:41:"http://codebetter.com/jeremymiller/?p=833";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:1482:"<p>Unfortunately, the original AgileATX has died an untimely death.  Between Dovetail, Headspring, and Drilling Info, we&#8217;re attempting to reboot what had been my favorite developer group &#8212; but make it a bit more focused without losing the social aspect that we enjoyed for so many years.  Chad&#8217;s got <a href="http://www.lostechies.com/blogs/chad_myers/archive/2011/01/28/announcing-atx-code-lunch.aspx">all the details right here</a>, with the first announced lunch on Thursday, February 3rd at the Mighty Fine off Mopac in the Arbor Walk.</p>
<p>Do note that nobody has said anything about a specific platform or methodology.  All types of developers or testers (or PM&#8217;s if you wanna come too) are invited &#8212; especially people working with cool technologies that I&#8217;ve never been exposed to;)</p>
<p>I think at the moment the idea is to center it up North, but that&#8217;s open for discussion.</p>
<p>We&#8217;re just getting started, so the format isn&#8217;t remotely set.  I know I&#8217;d also like to see us do a monthly(?) show and tell type get together to look at real project work and swap ideas. Other people are recommending days when we do lightning talks.  If you have an opinion, come express it and make it a group that you&#8217;d look forward to going to.</p>
<p>I hope to see you there.  Austinites, please tweet or repost this.</p><img src="http://feeds.feedburner.com/~r/CodeBetter/~4/WT0zBWBVZLY" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:13:"Jeremy Miller";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:85:"http://codebetter.com/jeremymiller/2011/01/28/announcing-the-new-atx-code-lunch/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:80:"http://codebetter.com/jeremymiller/2011/01/28/announcing-the-new-atx-code-lunch/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:16;a:6:{s:4:"data";s:48:"
		
		
		
		
		
				
		
			
					
			
				
					";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:4:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:38:"Collection Hosting Using Windows Azure";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:57:"http://feedproxy.google.com/~r/CodeBetter/~3/PaSrezAJgEk/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:98:"http://codebetter.com/howarddierking/2011/01/28/collection-hosting-using-windows-azure-2/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Fri, 28 Jan 2011 01:00:20 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:2:{i:0;a:5:{s:4:"data";s:13:"MSDN Magazine";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:1;a:5:{s:4:"data";s:5:"Pivot";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:42:"http://codebetter.com/howarddierking/?p=72";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:9547:"<p>As I’ve mentioned in a couple earlier posts, Pivot is driven using Deep Zoom image pyramids.  This means that for a collection of trade card images, multiple additional image combinations are generated for different zoom levels.  The net result here is a LOT of generated images.  For example, in the case of the MSDN Magazine Pivot collection, there are roughly 2400 article trade cards.  Generating the deep zoom collection from this set of input images yields roughly 100,000 images with a total collection size of just under 500 MB.</p>
<p>As you can see, there are a ton of images generated, and a reasonable number of bytes that need to be stored, cached, etc.  For the MSDN Magazine collection, hosting the collection in our data center architecture wasn’t really a viable option for several reasons – the most notable one being that there’s not a really great story for managing large collections of images that change on a frequency or schedule that is different than the monthly platform release schedule.  Fortunately, Azure blob storage provides a really simple solution for dealing with this problem, as well as a few others.  Here’s how I setup Azure hosting for the MSDN Magazine Pivot collection.</p>
<h1>CDN Caching</h1>
<p>One of the nice things about hosting the collection in Azure blob storage is that enabling CDN edge caching as simple as one button click (see the upper left corner in the image below).  For more information about CDN, check out <a href="http://en.wikipedia.org/wiki/Content_delivery_network">http://en.wikipedia.org/wiki/Content_delivery_network</a></p>
<p><a href="http://codebetter.com/howarddierking/files/2011/01/azure-portal-storage.png"><img style="margin: 0px 0px 24px;padding-left: 0px;padding-right: 0px;padding-top: 0px;border-width: 0px" src="http://codebetter.com/howarddierking/files/2011/01/azure-portal-storage_thumb.png" border="0" alt="azure-portal-storage" width="355" height="250" /></a></p>
<h1>Silverlight Client Access Policy</h1>
<p>I knew pretty early on that I wanted to host my cxml and Deep Zoom image pyramids in Azure blob storage.  However, my initial plan was to store the Silverlight xap file on our own Web platform and simply pull in the data.  As all of you Silverlight aficionados already know, while this is totally doable, you need to ensure that you have a <a href="http://msdn.microsoft.com/en-us/library/cc645032.aspx">client access policy XML file</a> at the URL root of whatever resource you’re trying to access.  For Azure blob storage, you’ll want to put this file in a special <a href="http://msdn.microsoft.com/en-us/library/ee395424.aspx">$root container</a>.  Doing this will apply the policies you declare to all containers in that blob storage account.</p>
<p>Like I said, my original plan was to host the collection in Azure and xap containing the Pivot viewer on our servers.  However, as I progressed in developing the solution, I realized something different.  There were no restrictions preventing me from hosting the xap itself in blob storage along with the collection data, and that by doing this, I would get 2 additional benefits:</p>
<ol>
<li>I no longer had a need for a clientaccesspolicy.xml file, since the xap and the data were now in the same domain.</li>
<li>By simplifying things with #1, I could now make the entire magazine Pivot experience available to anybody that wanted to embed it in his or her own site – for example, check out <a href="http://mtaulty.com/CommunityServer/blogs/mike_taultys_blog/archive/2010/08/19/pivotviewer-collections-and-the-silverlight-control.aspx">this point on Mike Taulty’s blog</a>.  Because everything needed for the Pivot experience is now sitting up in blob storage, the only code needed for anybody who wants to include the experience in his/her site is just the Silverlight object creation code.</li>
</ol>
<pre class="brush: xml; title: ;" title="">
&lt;object data=&quot;data:application/x-silverlight-2,&quot; height=&quot;100%&quot; type=&quot;application/x-silverlight-2&quot; width=&quot;100%&quot;&gt;
   &lt;param name=&quot;source&quot; value=&quot;http://az7446.vo.msecnd.net/msdn-magazine/Magazines.PivotViewer.xap&quot;&gt;
   &lt;param name=&quot;onError&quot; value=&quot;onSilverlightError&quot;&gt;
   &lt;param name=&quot;background&quot; value=&quot;white&quot;&gt;
   &lt;param name=&quot;minRuntimeVersion&quot; value=&quot;4.0.50401.0&quot;&gt;
   &lt;param name=&quot;autoUpgrade&quot; value=&quot;true&quot;&gt;
   &lt;param name=&quot;enableHtmlAccess&quot; value=&quot;true&quot;&gt;
   &lt;param name=&quot;initParams&quot; value=&quot;collection=http://az7446.vo.msecnd.net/msdn-magazine/msdnmagazine.cxml, defaultViewState=%24facet0%24=Issue%20Date&amp;amp;%24view%24=2&quot;&gt;
   &lt;a href=&quot;http://go.microsoft.com/fwlink/?LinkID=149156&amp;amp;v=4.0.50401.0&quot; style=&quot;text-decoration:none;&quot; &gt;
      &lt;img alt=&quot;Get Microsoft Silverlight&quot; src=&quot;http://go.microsoft.com/fwlink/?LinkId=161376&quot; style=&quot;border-style:none&quot;&gt;
   &lt;/a&gt;
&lt;/object&gt;
</pre>
<h1>Uploading</h1>
<p>As I’m sure you can imagine, uploading 100,000 files to Azure can take a bit of time – and fortunately, from a brief bit of looking around, it seems as though there are more commercial tools to enable a performant upload experience.  At the time that I was working on the magazine collection, there was unfortunately not a ton of tools that could do what I needed – and so I wrote my own tool.  The requirements (and the resulting program) are pretty simple: recursively process a directory and all its contained files and upload all the files.  Additionally, because I’ve got a rockin’ machine with plenty of processor cores to go around, I made sure to take advantage of some of the opportunities for parallelism provided by the <a href="http://blogs.msdn.com/b/pfxteam/">parallel extensions</a> in .NET 4.  I was completely new to the Azure client libs but was fortunate enough to <a href="http://blog.smarx.com/posts/pivot-odata-and-windows-azure-visual-netflix-browsing">get help from Steve Marx</a> (the guy on the Azure team who did the Netflix collection) – so many thanks to Steve!</p>
<p>At any rate, the code to do the upload looks like this:</p>
<pre class="brush: csharp; title: ;" title="">
private static void Main(string[] args) {
    if (args.Length &lt; 3) {
        Console.WriteLine(&quot;Pivot.BlobStorageUpload.exe CollectionPath AccountName AccountKey&quot;);
        return;
    }

    var pivotCollectionFldr = args[0];
    var accountName = args[1];
    var key = args[2];

    const string magazineContainer = &quot;msdn-magazine&quot;;

    var storageAccount = CloudStorageAccount.Parse(string.Format(&quot;DefaultEndpointsProtocol=http;AccountName={0};AccountKey={1}&quot;,accountName, key));
    var client = storageAccount.CreateCloudBlobClient();

    var container = client.GetContainerReference(magazineContainer);

    UploadDirectoryRecursive(pivotCollectionFldr, container);

    Console.WriteLine(&quot;\nFinished!  Press any key to continue...&quot;);
    Console.ReadLine();
}

private static void UploadDirectoryRecursive(string pivotCollectionFolder, CloudBlobContainer container) {
    string cxmlPath = null;

    // use 16 threads to upload
    Parallel.ForEach(EnumerateDirectoryRecursive(pivotCollectionFolder),
                        new ParallelOptions {MaxDegreeOfParallelism = 16},
                        filePath =&gt; {
                            if (Path.GetExtension(filePath) == &quot;.cxml&quot;)    // save #####.cxml for last
                                cxmlPath = filePath;
                            else {
                                var blobAddressUri = Path.GetFullPath(filePath).Substring(pivotCollectionFolder.Length + 1);
                                var blob = container.GetBlobReference(blobAddressUri);
                                UploadFile(filePath, blob);   // upload each file, using the relative path as a blob name
                            }
                        });

    // finish up with the cxml itself
    if (cxmlPath != null)
        UploadFile(cxmlPath, container.GetBlobReference(Path.GetFullPath(cxmlPath).Substring(pivotCollectionFolder.Length + 1)));
}

private static IEnumerable&lt;string&gt; EnumerateDirectoryRecursive(string root) {
    foreach (var file in Directory.GetFiles(root))
        yield return file;
    foreach (var subdir in Directory.GetDirectories(root))
        foreach (var file in EnumerateDirectoryRecursive(subdir))
            yield return file;
}

private static void UploadFile(string filePath, CloudBlob blob) {
    var extension = Path.GetExtension(filePath).ToLower();
    blob.Properties.CacheControl = extension == &quot;.cxml&quot; ? &quot;max-age=1800&quot; : &quot;max-age=7200&quot;;

    switch (extension) {
        case &quot;.xml&quot;:
        case &quot;.cxml&quot;:
        case &quot;.dzi&quot;:
        case &quot;.dzc&quot;:
            blob.Properties.ContentType = &quot;application/xml&quot;;
            break;
        case &quot;.jpg&quot;:
            blob.Properties.ContentType = &quot;image/jpeg&quot;;
            break;
        case &quot;.ico&quot;:
            blob.Properties.ContentType = &quot;image/x-icon&quot;;
            break;
    }
    blob.UploadFile(filePath);
    Console.Write(&quot;*&quot;);
}
</pre><img src="http://feeds.feedburner.com/~r/CodeBetter/~4/PaSrezAJgEk" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:15:"Howard Dierking";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:94:"http://codebetter.com/howarddierking/2011/01/28/collection-hosting-using-windows-azure-2/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:89:"http://codebetter.com/howarddierking/2011/01/28/collection-hosting-using-windows-azure-2/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:17;a:6:{s:4:"data";s:48:"
		
		
		
		
		
				
		
			
					
			
				
					";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:4:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:39:"Creating the MSDN Magazine Pivot Client";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:57:"http://feedproxy.google.com/~r/CodeBetter/~3/FpHqyx-vdHw/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:97:"http://codebetter.com/howarddierking/2011/01/27/creating-the-msdn-magazine-pivot-client/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Thu, 27 Jan 2011 23:34:16 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:2:{i:0;a:5:{s:4:"data";s:13:"MSDN Magazine";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:1;a:5:{s:4:"data";s:5:"Pivot";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:42:"http://codebetter.com/howarddierking/?p=85";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:16529:"<p>When non-developers approach Pivot, they tend to be dismayed by 2 primary things:</p>
<ul>
<li>it’s not something that you can just plug into your data source and have it work
<li>it’s not some discrete thing that you can just slap onto a Web page and have it work</li>
</ul>
<p>We’ve talked about the data aspects of building the MSDN Magazine collection in <a href="http://codebetter.com/howarddierking/2010/10/28/generating-the-collection-data/">previous</a> <a href="http://codebetter.com/howarddierking/2010/09/20/data-and-design-the-chicken-and-egg-problem/">posts</a>.&nbsp; What I want to review in this post is the actual client work required to make the show the collection.&nbsp; There are actually 2 parts to the client work: the Silverlight project which extends the Silverlight Pivot viewer control, and the JavaScript which creates the Silverlight object and listens to events on it.</p>
<h1>Creating the Silverlight XAP</h1>
<p>When you download the <a href="http://www.silverlight.net/learn/pivotviewer/">Pivot SDK</a>, you’ll get the Pivot viewer control – just a standard Silverlight control.&nbsp; Most of the work, then is just packaging that control into a xap file by wrapping it into a Silverlight project and putting it on the mainpage.xaml file (or whatever you’ve declared as your applications RootVisual object).&nbsp; From there, you basically just write code to control the behavior of the control (e.g. what cxml to load, how to handle errors, catching events).&nbsp; As you can see, there’s really not all that much to it:</p>
<p><a href="http://codebetter.com/howarddierking/files/2011/01/pivot-viewer-sl-solution.png"><img style="border-right-width: 0px;margin: 0px 0px 24px;padding-left: 0px;padding-right: 0px;border-top-width: 0px;border-bottom-width: 0px;border-left-width: 0px;padding-top: 0px" border="0" alt="pivot-viewer-sl-solution" src="http://codebetter.com/howarddierking/files/2011/01/pivot-viewer-sl-solution_thumb.png" width="274" height="190"></a></p>
<p>That said, there are a couple interesting extensions that I did to enable some capabilities on the control.&nbsp; Specifically, I derived my own control from PivotViewer so that I could hook a protected method and execute conditional logic for the action buttons on a trade card.&nbsp; I also made the Silverlight object scriptable and added a bunch of events so that could better instrument the Pivot experience with our BI system.</p>
<h2>Inheriting from PivotViewer</h2>
<p>As you may have noticed in the MSDN Magazine collection, a trade card can have up to 2 possible action buttons: one button to go read the article and another one to go and get associated sample code.&nbsp; </p>
<p><a href="http://codebetter.com/howarddierking/files/2011/01/action-buttons.png"><img style="border-right-width: 0px;margin: 0px 0px 24px;padding-left: 0px;padding-right: 0px;border-top-width: 0px;border-bottom-width: 0px;border-left-width: 0px;padding-top: 0px" border="0" alt="action-buttons" src="http://codebetter.com/howarddierking/files/2011/01/action-buttons_thumb.png" width="413" height="115"></a></p>
<p>However, not every article has sample code, and as such, I need to be able to execute some conditional logic to determine whether or not to display the action button.&nbsp; You would hope/expect that the PivotViewer control would expose a method or event which you could hook per collection item that would enable you to specify the custom actions for that item – and you would be right – kind of.&nbsp; The PivotViewer does expose this in the form of a method override.&nbsp; The problem is that it’s a protected method.&nbsp; As a result, I created a custom class deriving from PivotViewer so that I could override the appropriate method and basically expose that method’s functionality to consumers of my custom PivotViewer.</p>
<p><pre class="brush: csharp; title: ;" title="">public class CustomPivotViewer : System.Windows.Pivot.PivotViewer
{
    public Func&lt;string, List&lt;CustomAction&gt;&gt; GetCustomActionsForItemCallback { get; set; }

    protected override List&lt;CustomAction&gt; GetCustomActionsForItem(string itemId) {
        List&lt;CustomAction&gt; customActions = null;

        if (GetCustomActionsForItemCallback != null)
            customActions = GetCustomActionsForItemCallback(itemId);

        return customActions;
    }
}
</pre>
<p>Back in my MainPage.xaml.cs code behind file, then (where I manipulate the instance of my custom PivotViewer object), I then have the following:</p>
<p><pre class="brush: csharp; title: ;" title="">private List&lt;CustomAction&gt; GetCustomActionsForItem(string itemId) {
    var customActions = new List&lt;CustomAction&gt;();

    var item = MagazinePivotViewer.GetItem(itemId);
    if (item.Facets[FACET_KEY_HAS_CODE].First() == FACET_VALUE_HAS_CODE)
        customActions.Add(_getCodeAction);

    if (!string.IsNullOrEmpty(item.Href))
        customActions.Add(_readArticleAction);

    return customActions;
}
</pre>
<p>As the PivotViewer control brings each item’s trade card into focus, it calls the GetCustomActionsForItem method, which my custom class overrides and then delegates to my code behind class using a callback.&nbsp; In my code behind class, that callback function runs the necessary conditional logic and returns a list containing the appropriate actions.&nbsp; The action instances themselves are&nbsp; created during xap initialization and are held in static fields for improving performance.</p>
<h2>Making it Scriptable</h2>
<p>The other major way that I’ve extended the default Pivot viewer functionality is to make my xap scriptable to my HTML page, and forward events coming from the viewer control out to the page.&nbsp; I did this for the MSDN Magazine collection specifically so that I could wire the control up to our business intelligence service (we use Omniture).&nbsp; In case you’ve never had to deal with one of these systems (Omniture, WebTrends, etc.), they don’t just sit on the back end and parse the Web server’s log files.&nbsp; Rather, they rely on an additional HTTP call from the client to the service’s servers.&nbsp; This level of indirection enables the site owners to provide additional detail which can then be used to slice and dice blunt stats such as page views when performing analysis.&nbsp; For the Pivot viewer, I wanted to feed into the analytics system was not just how many people were using the Pivot experience, but *how* they were using it (e.g. are there specific facet categories that are used more than others, do people drill-through or re-pivot using the info pane, etc.).&nbsp; This insight can then be used to drive things like the order in which I show facet categories (or whether I can get rid of categories) and what features I add going forward.</p>
<p>Making the Silverlight object scriptable was pretty straightforward.&nbsp; The first thing to do is register my xap’s mainpage object as a scriptable object using a static method on the HtmlPage class:</p>
<p><pre class="brush: csharp; title: ;" title="">
HtmlPage.RegisterScriptableObject(&quot;PivotViewer&quot;, this);
</pre>
<p>Next, it was just a matter of creating all of the events that I wanted to expose as scriptable.&nbsp; The only requirement that goes beyond the normal pattern for exposing events in .NET is to ensure that the event declaration is decorated with the <a href="http://msdn.microsoft.com/en-us/library/system.windows.browser.scriptablememberattribute(v=vs.95).aspx">ScriptableMemberAttribute</a>:</p>
<p><pre class="brush: csharp; title: ;" title="">
[ScriptableMember]
public event EventHandler&lt;PivotViewerStateEventArgs&gt; ArticleButtonClicked;

[ScriptableMember]
public event EventHandler&lt;PivotViewerStateEventArgs&gt; ArticleLinkClicked;

[ScriptableMember]
public event EventHandler&lt;PivotViewerStateEventArgs&gt; CodeButtonClicked;

[ScriptableMember]
public event EventHandler&lt;PivotViewerStateEventArgs&gt; FiltersChanged;

[ScriptableMember]
public event EventHandler&lt;PivotViewerStateEventArgs&gt; SortChanged;

[ScriptableMember]
public event EventHandler&lt;PivotViewerStateEventArgs&gt; ViewChanged;

protected virtual void OnArticleButtonClicked(string articleUrl) {
    if (ArticleButtonClicked != null)
        ArticleButtonClicked(this, new PivotViewerStateEventArgs { ArticleHref = articleUrl });
}

protected virtual void OnArticleLinkClicked(string articleUrl) {
    if (ArticleLinkClicked != null)
        ArticleLinkClicked(this, new PivotViewerStateEventArgs { ArticleHref = articleUrl });
}

protected virtual void OnCodeButtonClicked(string articleUrl, string codeUrl) {
    if (CodeButtonClicked != null)
        CodeButtonClicked(this, new PivotViewerStateEventArgs { ArticleHref = articleUrl, CodeHref = codeUrl });
}

protected virtual void OnFiltersChanged(string filterString) {
    if (FiltersChanged != null)
        FiltersChanged(this, new PivotViewerStateEventArgs { FilterCategories = filterString });
}

protected virtual void OnSortChanged(string sortFacet) {
    if (SortChanged != null)
        SortChanged(this, new PivotViewerStateEventArgs { SortFacet = sortFacet });
}

protected virtual void OnViewChanged(string view) {
    if (ViewChanged != null)
        ViewChanged(this, new PivotViewerStateEventArgs { View = view });
}
</pre>
<p>Because the events pass a custom EventArguments type, we need to also ensure that this custom type is decorated with <a href="http://msdn.microsoft.com/en-us/library/system.windows.browser.scriptabletypeattribute(v=vs.95).aspx">ScriptableTypeAttribute</a> and its members are decorated with <a href="http://msdn.microsoft.com/en-us/library/system.windows.browser.scriptablememberattribute(v=vs.95).aspx">ScriptableMemberAttribute</a>:</p>
<p><pre class="brush: csharp; title: ;" title="">
[ScriptableType]
public class PivotViewerStateEventArgs : EventArgs
{
    [ScriptableMember]
    public string ArticleHref { get; set; }

    [ScriptableMember]
    public string CodeHref { get; set; }

    [ScriptableMember]
    public string FilterCategories { get; set; }

    [ScriptableMember]
    public string SortFacet { get; set; }

    [ScriptableMember]
    public string State { get; set; }

    [ScriptableMember]
    public string View { get; set; }
}
</pre>
<p>Firing the event is consistent with everything you already know from .NET programming – nothing more to see here.</p>
<h1>Consuming the Silverlight</h1>
<p>Because the xap completely encapsulates the Pivot viewer control, the configuration of all inputs is performed by default in the code behind the mainpage.xaml file.&nbsp; In my case, I wanted to have some of these configuration options available through the creation script or markup.&nbsp; To enable this, I enabled several different inputs (including the location of the cxml and the default view state) to be passed in through the Silverlight object’s <a href="http://msdn.microsoft.com/en-us/library/system.windows.startupeventargs.initparams(v=vs.95).aspx">InitParams</a> collection.&nbsp; This is a comma separated list that the application host automatically parses and makes available as a dictionary – through the Application.Current.Host.InitParams object.&nbsp; If you’re creating the Silverlight object using the object tag, you can specify all the configuration options using a param element.&nbsp; In my case, I wrapped the client functionality in a Javascript object, and am therefore creating it using the following:</p>
<p><pre class="brush: jscript; title: ;" title="">
PivotViewer.prototype.renderIn = function (container) {
    var self = this;
    Silverlight.createObject(
                this.xapPath,
                container[0],
                &quot;magazinePivotViewer_SL&quot;,
                {
                    type: &quot;application/x-silverlight-2&quot;,
                    width: &quot;100%&quot;,
                    height: &quot;100%&quot;,
                    background: &quot;white&quot;,
                    version: &quot;4.0.50401.0&quot;,
                    enableHtmlAccess: 'true',
                    autoUpgrade: 'true'
                },
                {
                    onError: this.onSilverlightError,
                    onLoad: function (sender, e) {
                        self.onLoad(sender, e);
                    }
                },
                &quot;collection=&quot; + this.collectionPath + &quot;,defaultViewState=&quot; + this.defaultViewState,
                this);
}
</pre>
<p>If you take a look at the third line from the bottom, you can see where the init parameters is built up from some fields (which were set during the object initializer). Another function of the initializer is that it allows you to pass in JavaScript functions to handle the various state change events that I previously exposed in my mainpage.xaml code behind.</p>
<p><pre class="brush: jscript; title: ;" title="">
var PivotViewer = function (xapPath,
        collectionPath,
        defaultViewState,
        onArticleLinkClicked,
        onArticleButtonClicked,
        onCodeButtonClicked,
        onSortChanged,
        onViewChanged,
        onFiltersChanged) {
    this.xapPath = xapPath;
    this.collectionPath = collectionPath;
    this.defaultViewState = defaultViewState;

    this.onArticleLinkClicked = onArticleLinkClicked;
    this.onArticleButtonClicked = onArticleButtonClicked;
    this.onCodeButtonClicked = onCodeButtonClicked;
    this.onSortChanged = onSortChanged;
    this.onViewChanged = onViewChanged;
    this.onFiltersChanged = onFiltersChanged;

};
</pre>
<p>In order to wire these client side functions up to the scriptable events in my Silverlight code, I&#8217;m hooking the load event in the Silverlight initialization code, and then setting the input JavaScript functions to the Silverlight event members.</p>
<p><pre class="brush: jscript; title: ;" title="">
PivotViewer.prototype.onLoad = function (sender, e) {
  sender.Content.PivotViewer.ArticleLinkClicked = this.onArticleLinkClicked;
  sender.Content.PivotViewer.ArticleButtonClicked = this.onArticleButtonClicked;
  sender.Content.PivotViewer.CodeButtonClicked = this.onCodeButtonClicked;
  sender.Content.PivotViewer.FiltersChanged = this.onFiltersChanged;
  sender.Content.PivotViewer.ViewChanged = this.onViewChanged;
  sender.Content.PivotViewer.SortChanged = this.onSortChanged;
}
</pre>
<p>This then gives me the ability to react in my HTML page to the state change events that are happening in the Pivot viewer Silverlight control. For example, in order to create a state change &#8220;console&#8221;, I would initialize my Pivot collection using the following JQuery:</p>
<p><pre class="brush: jscript; title: ;" title="">
$(document).ready(function () {
    var sl = new PivotViewer(&quot;ClientBin/Magazines.PivotViewer.xap&quot;,
        &quot;http://az7446.vo.msecnd.net/msdn-magazine/msdnmagazine.cxml&quot;,
        &quot;%24facet0%24=Issue%20Date&amp;%24view%24=2&quot;,
        function (sender, e) { $(&quot;div#console&quot;).append(&quot;articleLinkClicked: &quot; + e.ArticleHref + &quot;&lt;br/&gt;&quot;); },
        function (sender, e) { $(&quot;div#console&quot;).append(&quot;articleButtonClicked: &quot; + e.ArticleHref + &quot;&lt;br/&gt;&quot;); },
        function (sender, e) { $(&quot;div#console&quot;).append(&quot;codeButtonClicked: [article - &quot; + e.ArticleHref + &quot;] [code - &quot; + e.CodeHref + &quot;]&quot; + &quot;&lt;br/&gt;&quot;); },
        function (sender, e) { $(&quot;div#console&quot;).append(&quot;sortChanged: &quot; + e.SortFacet + &quot;&lt;br/&gt;&quot;); },
        function (sender, e) { $(&quot;div#console&quot;).append(&quot;onViewChanged: &quot; + e.View + &quot;&lt;br/&gt;&quot;); },
        function (sender, e) { $(&quot;div#console&quot;).append(&quot;OnFiltersChanged: &quot; + e.FilterCategories + &quot;&lt;br/&gt;&quot;); })
            .renderIn($('div#silverlightControlHost'));
});
</pre>
<p>As I've mentioned before, my plan is to make all of the source code available to you through bitbucket (I need to do a little refactoring to get rid of some hard coded authentication strings and then I'll post the location). However, I hope this gives you a good idea of what was involved in creating the Pivot UX parts of the <a href="http://msdn.microsoft.com/magazine">MSDN Magazine pivot collection</a>.</p><img src="http://feeds.feedburner.com/~r/CodeBetter/~4/FpHqyx-vdHw" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:15:"Howard Dierking";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:93:"http://codebetter.com/howarddierking/2011/01/27/creating-the-msdn-magazine-pivot-client/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:88:"http://codebetter.com/howarddierking/2011/01/27/creating-the-msdn-magazine-pivot-client/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:18;a:6:{s:4:"data";s:48:"
		
		
		
		
		
				
		
			
					
			
				
					";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:4:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:31:"Date/Time Support in NHibernate";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:57:"http://feedproxy.google.com/~r/CodeBetter/~3/qrYMFedfBQA/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:85:"http://codebetter.com/jameskovacs/2011/01/26/datetime-support-in-nhibernate/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Wed, 26 Jan 2011 16:00:00 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:2:{i:0;a:5:{s:4:"data";s:4:".NET";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:1;a:5:{s:4:"data";s:10:"NHibernate";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:76:"http://codebetter.com/jameskovacs/2011/01/26/datetime-support-in-nhibernate/";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:12873:"<p>[Code for this article is available on GitHub <a href="https://github.com/JamesKovacs/NH3Features/tree/02-DateTimeSupport">here</a>.]</p>
<p>In this post, we’ll examine the ways that NHibernate supports the DateTime-related data types, including some new features introduced in NHibernate 2 and 3. Here is a quick summary for the impatient.</p>
<table border="1" cellspacing="0" cellpadding="2">
<tbody>
<tr>
<td><strong>DbType</strong></td>
<td><strong>.NET</strong></td>
<td><strong>SQL Type</strong></td>
</tr>
<tr>
<td>DateTime</td>
<td>System.DateTime</td>
<td>datetime</td>
</tr>
<tr>
<td>LocalDateTime</td>
<td>System.DateTime</td>
<td>datetime</td>
</tr>
<tr>
<td>UtcDateTime</td>
<td>System.DateTime</td>
<td>datetime</td>
</tr>
<tr>
<td>DateTimeOffset</td>
<td>System.DateTimeOffset</td>
<td>datetimeoffset</td>
</tr>
<tr>
<td>DateTime2</td>
<td>System.DateTime</td>
<td>datetime2</td>
</tr>
<tr>
<td>Date</td>
<td>System.DateTime</td>
<td>date</td>
</tr>
<tr>
<td>Time</td>
<td>System.DateTime</td>
<td>time</td>
</tr>
<tr>
<td>TimeAsTimeSpan</td>
<td>System.TimeSpan</td>
<td>time</td>
</tr>
<tr>
<td>TimeSpan</td>
<td>System.TimeSpan</td>
<td>bigint (int64)</td>
</tr>
</tbody>
</table>
<h3>Local/UTC</h3>
<p>Let’s take a look at a few DateTime-related problems that developers have run into in the past…</p>
<pre class="brush: csharp;">public class DateTimeEntity {
    public DateTimeEntity() {
        CreationTime = DateTime.Now;
    }

    public virtual Guid Id { get; private set; }
    public virtual DateTime CreationTime { get; set; }
}</pre>
<p>Note that CreationTime is initialized using DateTime.Now. The corresponding mapping file would be:</p>
<pre class="brush: xml;">

&lt;hibernate-mapping xmlns="urn:nhibernate-mapping-2.2"

                   namespace="Nh3Hacking"

                   assembly="Nh3Hacking"&gt;
  &lt;class name="DateTimeEntity"&gt;
    &lt;id name="Id"&gt;
      &lt;generator class="guid.comb" /&gt;
    &lt;/id&gt;
    &lt;property name="CreationTime"/&gt;
  &lt;/class&gt;
&lt;/hibernate-mapping&gt;
</pre>
<p>If we create an instance of our DateTimeEntity and reload it, we get:</p>
<pre>Original entity:
Id: 09bead07-5a05-4459-a108-9e7501204918
        CreationTime: 2011-01-24 5:29:36 PM (Local)
Reloaded entity:
Id: 09bead07-5a05-4459-a108-9e7501204918
        CreationTime: 2011-01-24 5:29:36 PM (Unspecified)</pre>
<p>Note that I am outputting both CreationTime.ToString() and CreationTime.Kind. DateTime.Kind returns a DateTimeKind (surprising, huh?), which indicates whether this DateTime represents Local time or UTC time. We initialized the value with DateTime.Now, which is the local time. (If we wanted UTC time, we would use DateTime.UtcNow.) When the object is reloaded, the DateTimeKind is Unspecified. This is because the database does not store whether the DateTime value is Local or UTC. NHibernate has no way of knowing which one it is, hence Unspecified.</p>
<p>NHibernate 3 includes two new DbTypes that allow us to resolve this ambiguity. In our mapping file, we can write:</p>
<pre class="brush: xml;">&lt;property name="CreationTimeAsLocalDateTime" type="LocalDateTime"/&gt;
&lt;property name="CreationTimeAsUtcDateTime" type="UtcDateTime"/&gt;</pre>
<p>We are explicitly telling NHibernate whether the database stores Local or UTC times.</p>
<pre>Original entity:
Id: 09bead07-5a05-4459-a108-9e7501204918
        CreationTimeAsDateTime: 2011-01-24 5:29:36 PM (Local)
        CreationTimeAsLocalDateTime: 2011-01-24 5:29:36 PM (Local)
        CreationTimeAsUtcDateTime: 2011-01-25 12:29:36 AM (Utc)
Reloaded entity:
Id: 09bead07-5a05-4459-a108-9e7501204918
        CreationTimeAsDateTime: 2011-01-24 5:29:36 PM (Unspecified)
        CreationTimeAsLocalDateTime: 2011-01-24 5:29:36 PM (Local)
        CreationTimeAsUtcDateTime: 2011-01-25 12:29:36 AM (Utc)</pre>
<p>This is strictly metadata and it is up to the developer to ensure that the proper DateTime is present in the property/field. For instance, if I initialize the entity as follows:</p>
<pre class="brush: csharp;">public DateTimeEntity() {
    CreationTimeAsDateTime = DateTime.Now;
    CreationTimeAsLocalDateTime = DateTime.UtcNow;
    CreationTimeAsUtcDateTime = DateTime.Now;
}</pre>
<p>Note that the LocalDateTime property contains a UTC DateTime and the UTC property contains a Local DateTime. The results are:</p>
<pre>Original entity:
Id: 4579d245-46f3-4c3f-893b-9e750124a90b
        CreationTimeAsDateTime: 2011-01-24 5:45:32 PM (Local)
        CreationTimeAsLocalDateTime: 2011-01-25 12:45:32 AM (Utc)
        CreationTimeAsUtcDateTime: 2011-01-24 5:45:32 PM (Local)
Reloaded entity:
Id: 4579d245-46f3-4c3f-893b-9e750124a90b
        CreationTimeAsDateTime: 2011-01-24 5:45:32 PM (Unspecified)
        CreationTimeAsLocalDateTime: 2011-01-25 12:45:32 AM (Local)
        CreationTimeAsUtcDateTime: 2011-01-24 5:45:32 PM (Utc)</pre>
<p>Notice that NHibernate did not perform any conversions or throw an exception when saving/loading a DateTime value with the wrong DateTimeKind. (It could be argued that NHibernate should throw an exception when asked to save a Local DateTime and the property is mapped as a UtcDateTime.) It is up to the developer to ensure that the proper kind of DateTime is in the appropriate field/property.</p>
<h3>System.DateTimeOffset</h3>
<p>One problem that LocalDateTime and UtcDateTime does not solve is the offset problem. If you have a DateTime and its Kind is Local, all you know is that it is a Local DateTime. You do not know if that Local DateTime is Mountain (MST), Eastern (EST), Pacific (PST), etc. You do not know whether it has been corrected for daylight savings time. All you know is that it is a Local DateTime. You have to assume that the local time is based on the time zone of the current computer. Although this is often a reasonable assumption, it’s not always. (Consider for example that you’re collecting log files from a distributed system and servers reside in multiple time zones.) The problem is that System.DateTime class does not contain a place to record the timezone offset. Microsoft solved this problem starting in .NET 3.5 by introducing the System.DateTimeOffset class. It looks a lot like System.DateTime, but does include the timezone offset rather than the DateTimeKind. So we can just use System.DateTimeOffset in our applications rather than System.DateTime.</p>
<p>Except… Date/time types in SQL databases do not have anywhere to store the timezone offset. The notable exception is SQL Server 2008, which introduced the datetimeoffset type. NHibernate 2 introduced support for System.DateTimeOffset, but only for SQL Server 2008 onwards. (If you’re using SQL Server 2005 or earlier or another database server, you’ll have to implement your own IUserType to store System.DateTimeOffset in two separate columns – one for the DateTime and the other for the timezone offset.) The additional code in DateTimeEntity.cs looks like this:</p>
<pre class="brush: csharp;">public virtual DateTimeOffset CreationTimeAsDateTimeOffset { get; set; }</pre>
<p>The mapping file just needs the new property added:</p>
<pre class="brush: xml;">&lt;property name="CreationTimeAsDateTimeOffset"/&gt;</pre>
<p>Note that I don’t need to specify the type in the mapping as NHibernate can infer it from the property type in DateTimeEntity. The resulting output is:</p>
<pre>Original entity:
Id: 95aa6c15-86f5-4398-aa9e-9e7600ae4580
        CreationTimeAsDateTime: 2011-01-25 10:34:30 AM (Local)
        CreationTimeAsLocalDateTime: 2011-01-25 10:34:30 AM (Local)
        CreationTimeAsUtcDateTime: 2011-01-25 5:34:30 PM (Utc)
        CreationTimeAsDateTimeOffset: 2011-01-25 10:34:30 AM -07:00
Reloaded entity:
Id: 95aa6c15-86f5-4398-aa9e-9e7600ae4580
        CreationTimeAsDateTime: 2011-01-25 10:34:30 AM (Unspecified)
        CreationTimeAsLocalDateTime: 2011-01-25 10:34:30 AM (Local)
        CreationTimeAsUtcDateTime: 2011-01-25 5:34:30 PM (Utc)
        CreationTimeAsDateTimeOffset: 2011-01-25 10:34:30 AM -07:00</pre>
<h3>Support for DateTime2, Date, and Time</h3>
<p>Let’s look at some C# and the corresponding mapping file for these types:</p>
<pre class="brush: csharp;">public virtual DateTime CreationTimeAsDateTime2 { get; set; }
public virtual DateTime CreationTimeAsDate { get; set; }
public virtual DateTime CreationTimeAsTime { get; set; }
public virtual TimeSpan CreationTimeAsTimeAsTimeSpan { get; set; }
public virtual TimeSpan CreationTimeAsTimeSpan { get; set; }</pre>
<p>Modifications to the hbm.xml:</p>
<pre class="brush: xml;">&lt;property name="CreationTimeAsDateTime2" type="DateTime2"/&gt;
&lt;property name="CreationTimeAsDate" type="Date"/&gt;
&lt;property name="CreationTimeAsTime" type="Time"/&gt;
&lt;property name="CreationTimeAsTimeAsTimeSpan" type="TimeAsTimeSpan"/&gt;
&lt;property name="CreationTimeAsTimeSpan"/&gt;</pre>
<p>We’ll examine each of these in turn…</p>
<p>DbType.DateTime2 is a higher precision, wider range version of DbType.DateTime. DbType.DateTime maps to the datetime (or smalldatetime) SQL type, which has a range of 1753-01-01 to 9999-12-31. DbType.DateTime2 maps to the datetime2 SQL type, which has a range of 0001-01-01 to 9999-12-31. (Precision can be as high as 1/10 of a microsecond with a datetime2(7).) One of the niceties of DateTime2 is that an uninitialized DateTime struct (which has a value of 0001-01-01 12:00:00 AM (Unspecified)) does not cause a SqlTypeException with a SqlDateTime underflow.</p>
<p>DbType.Date does just what it advertises. It represents a Date without a Time component. It is stored in the database as only a date. .NET does not have a Date type and NHibernate represents it via a DateTime with the time portion set to 12:00:00 AM. I personally prefer to define my own Date class, which has no time component, and create an IUserType to handle the mapping. My custom Date class can handle the time truncation and provide a more natural programing model for my domain, but that’s a post for another day.</p>
<p>Time-related DbTypes stores just the time, but no date. In .NET, there is no Time class and so NHibernate uses a DateTime with the date component set to 1753-01-01, the minimum value for a SQL datetime or a System.TimeSpan – depending on the DbType that we choose. DbType.Time stores a System.DateTime in a time SQL type. DbType.TimeAsTimeSpan stores a System.TimeSpan as a time SQL type. DbType.TimeSpan stores a Syste.TimeSpan as a 64-bit integer (bigint) SQL type. As I mentioned for DbType.Date, I am more inclined to write my own Time class and custom IUserType to achieve a better programming model than relying on the .NET constructs of System.DateTime and System.TimeSpan. (I typically use System.DateTime or System.TimeSpan as a field in my custom Date or Time class for storing the data, but provide my own API for consistently working with the data.)</p>
<p><strong>WARNING</strong>: Not all databases support all date/time SQL types. So before choosing .NET and SQL types for your entities, make sure that they’re available in all databases that you plan to support.</p>
<p>Now we’ll take a look at these date/time types in action:</p>
<pre>Original entity:
Id: 6b2fb9ff-8036-4c17-b9ef-9e7600bf37e3
        CreationTimeAsDateTime: 2011-01-25 11:36:12 AM (Local)
        CreationTimeAsLocalDateTime: 2011-01-25 11:36:12 AM (Local)
        CreationTimeAsUtcDateTime: 2011-01-25 6:36:12 PM (Utc)
        CreationTimeAsDateTimeOffset: 2011-01-25 11:36:12 AM -07:00
        CreationTimeAsDateTime2: 2011-01-25 11:36:12 AM (Local)
        CreationTimeAsDate: 2011-01-25 11:36:12 AM (Local)
        CreationTimeAsTime: 2011-01-25 11:36:12 AM (Local)
        CreationTimeAsTimeAsTimeSpan: 11:36:12.2688265
        CreationTimeAsTimeSpan: 11:36:12.2688265
Reloaded entity:
Id: 6b2fb9ff-8036-4c17-b9ef-9e7600bf37e3
        CreationTimeAsDateTime: 2011-01-25 11:36:12 AM (Unspecified)
        CreationTimeAsLocalDateTime: 2011-01-25 11:36:12 AM (Local)
        CreationTimeAsUtcDateTime: 2011-01-25 6:36:12 PM (Utc)
        CreationTimeAsDateTimeOffset: 2011-01-25 11:36:12 AM -07:00
        CreationTimeAsDateTime2: 2011-01-25 11:36:12 AM (Unspecified)
        CreationTimeAsDate: 2011-01-25 12:00:00 AM (Unspecified)
        CreationTimeAsTime: 1753-01-01 11:36:12 AM (Unspecified)
        CreationTimeAsTimeAsTimeSpan: 11:36:12.2700000
        CreationTimeAsTimeSpan: 11:36:12.2688265</pre>
<h3>Summary</h3>
<p>As you have seen, NHibernate has a wide variety of options for mapping date/time-related types to and from the database. The right choice is highly dependent on your application and database server. I hope that this post has given you a few more tricks up your sleeve for effectively mapping date/time-related types using NHibernate.</p><img src="http://feeds.feedburner.com/~r/CodeBetter/~4/qrYMFedfBQA" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:12:"James Kovacs";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:81:"http://codebetter.com/jameskovacs/2011/01/26/datetime-support-in-nhibernate/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:76:"http://codebetter.com/jameskovacs/2011/01/26/datetime-support-in-nhibernate/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:19;a:6:{s:4:"data";s:45:"
		
		
		
		
		
				
			
					
			
				
					";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:4:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:58:"If you are using StructureMap with MVC3, please read this:";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:57:"http://feedproxy.google.com/~r/CodeBetter/~3/mIws79BKKrQ/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:112:"http://codebetter.com/jeremymiller/2011/01/23/if-you-are-using-structuremap-with-mvc3-please-read-this/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Mon, 24 Jan 2011 03:49:49 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:1:{i:0;a:5:{s:4:"data";s:12:"StructureMap";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:41:"http://codebetter.com/jeremymiller/?p=827";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:661:"<p>Ok, a couple people are stumbling into some problems with using StructureMap with ASP.Net MVC3&#8242;s new IoC integration.  Steve Smith has a blog post <a href="http://stevesmithblog.com/blog/how-do-i-use-structuremap-with-asp-net-mvc-3/">here</a> that shows a correctly working version of using StructureMap as MVC3&#8242;s  IDependencyResolver.</p>
<p>The specific problem is in the IDependencyResolver.GetService(type) method.  MVC3 makes a different set of assumptions about IoC functionality than we did with StructureMap&#8217;s TryGetInstance(type) method.</p><img src="http://feeds.feedburner.com/~r/CodeBetter/~4/mIws79BKKrQ" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:13:"Jeremy Miller";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:108:"http://codebetter.com/jeremymiller/2011/01/23/if-you-are-using-structuremap-with-mvc3-please-read-this/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:103:"http://codebetter.com/jeremymiller/2011/01/23/if-you-are-using-structuremap-with-mvc3-please-read-this/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}}}s:44:"http://purl.org/rss/1.0/modules/syndication/";a:2:{s:12:"updatePeriod";a:1:{i:0;a:5:{s:4:"data";s:6:"hourly";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:15:"updateFrequency";a:1:{i:0;a:5:{s:4:"data";s:1:"1";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:27:"http://www.w3.org/2005/Atom";a:1:{s:4:"link";a:2:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:3:{s:3:"rel";s:4:"self";s:4:"type";s:19:"application/rss+xml";s:4:"href";s:38:"http://feeds.feedburner.com/CodeBetter";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:1;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:2:{s:3:"rel";s:3:"hub";s:4:"href";s:32:"http://pubsubhubbub.appspot.com/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:2:{s:4:"info";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:3:"uri";s:10:"codebetter";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:15:"browserFriendly";a:1:{i:0;a:5:{s:4:"data";s:138:"This is an XML content feed. It is intended to be viewed in a newsreader or syndicated to another site, subject to copyright and fair use.";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}}}}}}}}s:4:"type";i:128;s:7:"headers";a:11:{s:12:"content-type";s:23:"text/xml; charset=UTF-8";s:4:"etag";s:27:"X1lrC+UeoSsSSSY4WwmBzrF6RZo";s:13:"last-modified";s:29:"Tue, 22 Feb 2011 13:35:09 GMT";s:16:"content-encoding";s:4:"gzip";s:17:"transfer-encoding";s:7:"chunked";s:4:"date";s:29:"Tue, 22 Feb 2011 14:22:18 GMT";s:7:"expires";s:29:"Tue, 22 Feb 2011 14:22:18 GMT";s:13:"cache-control";s:18:"private, max-age=0";s:22:"x-content-type-options";s:7:"nosniff";s:16:"x-xss-protection";s:13:"1; mode=block";s:6:"server";s:3:"GSE";}s:5:"build";s:14:"20110128231735";}